<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ†ç»„è¿‡æ»¤å™¨è‡ªåŠ¨åŒ–æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f7;
            line-height: 1.6;
        }

        .test-container {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #007AFF;
            padding-bottom: 10px;
        }

        .test-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: #1d1d1f;
        }

        .test-status {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }

        .status-pending { background: #f2f2f7; color: #666; }
        .status-running { background: #e3f2fd; color: #1976d2; }
        .status-completed { background: #e8f5e8; color: #2e7d32; }
        .status-failed { background: #ffebee; color: #d32f2f; }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            padding: 20px;
            background: white;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #007AFF;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 600;
            color: #007AFF;
            display: block;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        .progress-container {
            margin: 20px 0;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #007AFF, #34C759);
            width: 0%;
            transition: width 0.3s ease;
            position: relative;
        }

        .progress-text {
            text-align: center;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #666;
        }

        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #fafafa;
            border-radius: 10px;
            border-left: 4px solid #007AFF;
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
        }

        .test-case {
            margin: 10px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
        }

        .test-case.running {
            border-color: #2196F3;
            background: #e3f2fd;
            animation: pulse 1.5s infinite;
        }

        .test-case.passed {
            border-color: #4CAF50;
            background: #e8f5e8;
        }

        .test-case.failed {
            border-color: #f44336;
            background: #ffebee;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .test-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .test-description {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
        }

        .test-result {
            font-family: monospace;
            font-size: 0.8rem;
            padding: 8px;
            border-radius: 4px;
            margin-top: 10px;
        }

        .test-result.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .test-result.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            white-space: pre-wrap;
        }

        .report-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px dashed #007AFF;
        }

        .report-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }

        .report-content {
            background: #1e1e1e;
            color: #f0f0f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            white-space: pre-wrap;
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
        }

        .copy-button {
            margin-top: 10px;
            padding: 10px 20px;
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .copy-button:hover {
            background: #0056CC;
        }

        .auto-start-notice {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1 class="test-title">ğŸ§ª åˆ†ç»„è¿‡æ»¤å™¨è‡ªåŠ¨åŒ–æµ‹è¯•</h1>
            <div class="test-status status-pending" id="overall-status">å‡†å¤‡å¯åŠ¨</div>
        </div>

        <div class="auto-start-notice">
            âš¡ æµ‹è¯•å°†åœ¨é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨å¼€å§‹ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <span class="stat-number" id="total-tests">0</span>
                <div class="stat-label">æ€»æµ‹è¯•æ•°</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="passed-tests">0</span>
                <div class="stat-label">é€šè¿‡</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="failed-tests">0</span>
                <div class="stat-label">å¤±è´¥</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="success-rate">0%</span>
                <div class="stat-label">æˆåŠŸç‡</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="duration">0s</span>
                <div class="stat-label">è€—æ—¶</div>
            </div>
        </div>

        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <div class="progress-text" id="progress-text">ç­‰å¾…å¼€å§‹...</div>
        </div>

        <div id="test-sections"></div>
    </div>

    <div class="report-section" id="report-section" style="display: none;">
        <h2 class="report-title">ğŸ“‹ æµ‹è¯•æŠ¥å‘Š (Plaintext)</h2>
        <div class="report-content" id="report-content"></div>
        <button class="copy-button" onclick="copyReport()">ğŸ“‹ å¤åˆ¶æŠ¥å‘Š</button>
    </div>

    <script>
        // å¼•å…¥æ ¸å¿ƒè„šæœ¬çš„å†…å®¹ï¼ˆé¿å…è·¨åŸŸé—®é¢˜ï¼‰
        // CONFIGå¯¹è±¡
        const CONFIG = {
            FORMATS: {
                DANBOORU: 'danbooru',
                GELBOORU: 'gelbooru', 
                STANDARD: 'standard'
            },
            
            FILTER: {
                STORAGE_KEY: 'tagConverter_filterSettings',
                GROUPED_STORAGE_KEY: 'tagConverter_groupedFilterSettings',
                DEFAULT_ENABLED: false,
                DEFAULT_KEYWORDS: [],
                DEFAULT_SIMPLIFY_ENABLED: false,
                SCHEMA_VERSION: 1,
                DEFAULT_GROUP_NAME_PREFIX: 'ç»„'
            }
        };

        // UUIDç”Ÿæˆå‡½æ•°
        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        // åˆ›å»ºé»˜è®¤ç»„
        function createDefaultGroup(name = '') {
            return {
                id: generateUUID(),
                name: name || `${CONFIG.FILTER.DEFAULT_GROUP_NAME_PREFIX} ${Date.now()}`,
                enabled: true,
                collapsed: true,
                keywords: [],
                replacement: '',
                meta: {
                    lastMatchCount: 0
                }
            };
        }

        // GroupedFilterManagerç±»
        class GroupedFilterManager {
            constructor() {
                this.masterEnabled = CONFIG.FILTER.DEFAULT_ENABLED;
                this.groups = [];
                this.simplifyEnabled = CONFIG.FILTER.DEFAULT_SIMPLIFY_ENABLED;
                this.lastSimplifiedCount = 0;
                this.lastTotalFilteredCount = 0;
            }
            
            loadSettings() {
                try {
                    const groupedSettings = localStorage.getItem(CONFIG.FILTER.GROUPED_STORAGE_KEY);
                    if (groupedSettings) {
                        this._loadGroupedSettings(JSON.parse(groupedSettings));
                    } else {
                        this._migrateFromOldSettings();
                    }
                } catch (error) {
                    this._initializeDefaults();
                }
            }
            
            _loadGroupedSettings(settings) {
                this.masterEnabled = settings.masterEnabled ?? CONFIG.FILTER.DEFAULT_ENABLED;
                this.simplifyEnabled = settings.simplifyEnabled ?? CONFIG.FILTER.DEFAULT_SIMPLIFY_ENABLED;
                
                this.groups = (settings.groups || []).map(group => ({
                    id: group.id || generateUUID(),
                    name: group.name || 'æœªå‘½åç»„',
                    enabled: group.enabled ?? true,
                    collapsed: group.collapsed ?? true,
                    keywords: group.keywords || [],
                    replacement: group.replacement || '',
                    meta: {
                        lastMatchCount: group.meta?.lastMatchCount ?? 0,
                        ...group.meta
                    }
                }));
            }
            
            _migrateFromOldSettings() {
                this._initializeDefaults();
            }
            
            _initializeDefaults() {
                this.masterEnabled = CONFIG.FILTER.DEFAULT_ENABLED;
                this.simplifyEnabled = CONFIG.FILTER.DEFAULT_SIMPLIFY_ENABLED;
                this.groups = [];
            }
            
            saveSettings() {
                try {
                    const settings = {
                        masterEnabled: this.masterEnabled,
                        simplifyEnabled: this.simplifyEnabled,
                        groups: this.groups,
                        schemaVersion: CONFIG.FILTER.SCHEMA_VERSION,
                        exportedAt: new Date().toISOString()
                    };
                    localStorage.setItem(CONFIG.FILTER.GROUPED_STORAGE_KEY, JSON.stringify(settings));
                } catch (error) {
                    console.warn('æ— æ³•ä¿å­˜è¿‡æ»¤å™¨è®¾ç½®:', error);
                }
            }
            
            getStatus() {
                const totalGroups = this.groups.length;
                const enabledGroups = this.groups.filter(g => g.enabled).length;
                
                return {
                    enabled: this.masterEnabled,
                    simplifyEnabled: this.simplifyEnabled,
                    keywordCount: totalGroups,
                    enabledGroupCount: enabledGroups,
                    lastFilteredCount: this.lastTotalFilteredCount,
                    lastSimplifiedCount: this.lastSimplifiedCount,
                    groups: this.groups
                };
            }
            
            setMasterEnabled(enabled) {
                this.masterEnabled = Boolean(enabled);
                this.saveSettings();
            }
            
            setSimplifyEnabled(enabled) {
                this.simplifyEnabled = Boolean(enabled);
                this.saveSettings();
            }
            
            addGroup(name = '') {
                const defaultName = name || `${CONFIG.FILTER.DEFAULT_GROUP_NAME_PREFIX} ${this.groups.length + 1}`;
                const newGroup = createDefaultGroup(defaultName);
                this.groups.push(newGroup);
                this.saveSettings();
                return newGroup;
            }
            
            duplicateGroup(groupId) {
                const sourceGroup = this.groups.find(g => g.id === groupId);
                if (!sourceGroup) return null;
                
                const duplicatedGroup = {
                    ...sourceGroup,
                    id: generateUUID(),
                    name: `${sourceGroup.name}(å‰¯æœ¬)`,
                    meta: { lastMatchCount: 0 }
                };
                
                const sourceIndex = this.groups.findIndex(g => g.id === groupId);
                this.groups.splice(sourceIndex + 1, 0, duplicatedGroup);
                
                this.saveSettings();
                return duplicatedGroup;
            }
            
            deleteGroup(groupId) {
                const index = this.groups.findIndex(g => g.id === groupId);
                if (index === -1) return false;
                
                this.groups.splice(index, 1);
                this.saveSettings();
                return true;
            }
            
            updateGroup(groupId, updates) {
                const group = this.groups.find(g => g.id === groupId);
                if (!group) return false;
                
                Object.assign(group, updates);
                this.saveSettings();
                return true;
            }
            
            getGroup(groupId) {
                return this.groups.find(g => g.id === groupId) || null;
            }
            
            reorderGroups(groupIds) {
                const newGroups = [];
                
                for (const id of groupIds) {
                    const group = this.groups.find(g => g.id === id);
                    if (group) {
                        newGroups.push(group);
                    }
                }
                
                for (const group of this.groups) {
                    if (!newGroups.find(g => g.id === group.id)) {
                        newGroups.push(group);
                    }
                }
                
                this.groups = newGroups;
                this.saveSettings();
            }
            
            clearMatchCounts(groupId = null) {
                if (groupId) {
                    const group = this.getGroup(groupId);
                    if (group) {
                        group.meta.lastMatchCount = 0;
                    }
                } else {
                    this.groups.forEach(group => {
                        group.meta.lastMatchCount = 0;
                    });
                }
                this.saveSettings();
            }
            
            applyFilter(tags) {
                if (!this.masterEnabled) {
                    return tags;
                }
                
                let currentTags = [...tags];
                let totalFilteredCount = 0;
                
                for (const group of this.groups) {
                    if (!group.enabled || group.keywords.length === 0) {
                        group.meta.lastMatchCount = 0;
                        continue;
                    }
                    
                    const result = this._applyGroupFilter(currentTags, group);
                    currentTags = result.filteredTags;
                    group.meta.lastMatchCount = result.matchCount;
                    totalFilteredCount += result.matchCount;
                }
                
                this.lastTotalFilteredCount = totalFilteredCount;
                
                if (this.simplifyEnabled) {
                    const simplifiedTags = this._simplifyTags(currentTags);
                    this.lastSimplifiedCount = currentTags.length - simplifiedTags.length;
                    currentTags = simplifiedTags;
                } else {
                    this.lastSimplifiedCount = 0;
                }
                
                return currentTags;
            }
            
            _applyGroupFilter(tags, group) {
                const patterns = this._compileGroupPatterns(group.keywords);
                const matchedIndices = new Set();
                
                tags.forEach((tag, index) => {
                    for (const pattern of patterns) {
                        try {
                            if (pattern.test(tag)) {
                                matchedIndices.add(index);
                                break;
                            }
                        } catch (error) {
                            if (tag.includes(pattern.source || pattern)) {
                                matchedIndices.add(index);
                                break;
                            }
                        }
                    }
                });
                
                if (matchedIndices.size === 0) {
                    return { filteredTags: tags, matchCount: 0 };
                }
                
                let filteredTags = tags.filter((_, index) => !matchedIndices.has(index));
                
                if (group.replacement && this._isValidReplacement(group.replacement)) {
                    const replacementTokens = this._parseReplacementString(group.replacement);
                    if (replacementTokens.length > 0) {
                        const insertPosition = Math.min(...matchedIndices);
                        filteredTags.splice(insertPosition, 0, ...replacementTokens);
                    }
                }
                
                filteredTags = this._dedupeKeepFirst(filteredTags);
                
                return { 
                    filteredTags, 
                    matchCount: matchedIndices.size 
                };
            }
            
            _compileGroupPatterns(keywords) {
                const patterns = [];
                
                for (const keyword of keywords) {
                    if (!keyword.trim()) continue;
                    
                    try {
                        const pattern = new RegExp(keyword, 'i');
                        pattern.test('');
                        patterns.push(pattern);
                    } catch (error) {
                        const escapedKeyword = keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                        patterns.push(new RegExp(`^${escapedKeyword}$`, 'i'));
                    }
                }
                
                return patterns;
            }
            
            _isValidReplacement(replacement) {
                if (!replacement.trim()) return true;
                
                if (replacement.includes(',') && !replacement.includes(', ')) {
                    return false;
                }
                
                return true;
            }
            
            _parseReplacementString(replacement) {
                if (!replacement.trim()) return [];
                
                return replacement
                    .split(', ')
                    .map(token => token.trim())
                    .filter(token => token.length > 0);
            }
            
            _dedupeKeepFirst(array) {
                const seen = new Set();
                return array.filter(item => {
                    if (seen.has(item)) {
                        return false;
                    }
                    seen.add(item);
                    return true;
                });
            }
            
            _simplifyTags(tags) {
                if (!tags || tags.length <= 1) return tags;
                
                const indexedTags = tags.map((tag, index) => ({ tag, originalIndex: index }));
                const result = [];
                
                for (let i = 0; i < indexedTags.length; i++) {
                    const currentItem = indexedTags[i];
                    let isContained = false;
                    
                    for (let j = 0; j < indexedTags.length; j++) {
                        if (i === j) continue;
                        
                        const otherItem = indexedTags[j];
                        if (otherItem.tag.includes(currentItem.tag) && otherItem.tag !== currentItem.tag) {
                            isContained = true;
                            break;
                        }
                    }
                    
                    if (!isContained) {
                        result.push(currentItem);
                    }
                }
                
                return result
                    .sort((a, b) => a.originalIndex - b.originalIndex)
                    .map(item => item.tag);
            }
            
            exportConfig() {
                const config = {
                    masterEnabled: this.masterEnabled,
                    simplifyEnabled: this.simplifyEnabled,
                    groups: this.groups,
                    schemaVersion: CONFIG.FILTER.SCHEMA_VERSION,
                    exportedAt: new Date().toISOString()
                };
                
                return JSON.stringify(config, null, 2);
            }
            
            validateImportConfig(config) {
                if (!config || typeof config !== 'object') {
                    return { valid: false, error: 'é…ç½®æ ¼å¼æ— æ•ˆ' };
                }
                
                if (typeof config.masterEnabled !== 'boolean') {
                    return { valid: false, error: 'ç¼ºå°‘ masterEnabled å­—æ®µ' };
                }
                
                if (!Array.isArray(config.groups)) {
                    return { valid: false, error: 'ç¼ºå°‘ groups å­—æ®µæˆ–æ ¼å¼é”™è¯¯' };
                }
                
                for (let i = 0; i < config.groups.length; i++) {
                    const group = config.groups[i];
                    if (!group.id || typeof group.name !== 'string' || !Array.isArray(group.keywords)) {
                        return { valid: false, error: `ç»„ ${i + 1} æ•°æ®ç»“æ„æ— æ•ˆ` };
                    }
                }
                
                const migratedConfig = this._migrateConfigSchema(config);
                
                return { valid: true, migratedConfig };
            }
            
            importConfig(configJson, append = false) {
                try {
                    const config = JSON.parse(configJson);
                    const validation = this.validateImportConfig(config);
                    
                    if (!validation.valid) {
                        return { success: false, error: validation.error };
                    }
                    
                    const importConfig = validation.migratedConfig;
                    
                    if (append) {
                        const newGroups = importConfig.groups.map(group => ({
                            ...group,
                            id: generateUUID(),
                            meta: { lastMatchCount: 0 }
                        }));
                        
                        this.groups.push(...newGroups);
                        
                        return { 
                            success: true, 
                            importedGroups: newGroups.length 
                        };
                    } else {
                        this.masterEnabled = importConfig.masterEnabled;
                        this.simplifyEnabled = importConfig.simplifyEnabled ?? this.simplifyEnabled;
                        this.groups = importConfig.groups.map(group => ({
                            ...group,
                            meta: {
                                lastMatchCount: 0,
                                ...group.meta
                            }
                        }));
                        
                        return { 
                            success: true, 
                            importedGroups: this.groups.length 
                        };
                    }
                } catch (error) {
                    return { 
                        success: false, 
                        error: `JSONè§£æå¤±è´¥: ${error.message}` 
                    };
                } finally {
                    this.saveSettings();
                }
            }
            
            _migrateConfigSchema(config) {
                const migrated = { ...config };
                
                migrated.groups = config.groups.map(group => ({
                    id: group.id || generateUUID(),
                    name: group.name || 'æœªå‘½åç»„',
                    enabled: group.enabled ?? true,
                    collapsed: group.collapsed ?? true,
                    keywords: group.keywords || [],
                    replacement: group.replacement || '',
                    meta: {
                        lastMatchCount: 0,
                        ...group.meta
                    }
                }));
                
                if (typeof migrated.simplifyEnabled !== 'boolean') {
                    migrated.simplifyEnabled = CONFIG.FILTER.DEFAULT_SIMPLIFY_ENABLED;
                }
                
                return migrated;
            }
            
            getImportPreview(configJson) {
                try {
                    const config = JSON.parse(configJson);
                    const validation = this.validateImportConfig(config);
                    
                    if (!validation.valid) {
                        return { valid: false, error: validation.error };
                    }
                    
                    const importConfig = validation.migratedConfig;
                    const groupNames = importConfig.groups.map(g => g.name);
                    const totalKeywords = importConfig.groups.reduce((sum, g) => sum + g.keywords.length, 0);
                    
                    return {
                        valid: true,
                        preview: {
                            masterEnabled: importConfig.masterEnabled,
                            simplifyEnabled: importConfig.simplifyEnabled,
                            groupCount: importConfig.groups.length,
                            groupNames,
                            totalKeywords,
                            schemaVersion: importConfig.schemaVersion,
                            exportedAt: importConfig.exportedAt
                        }
                    };
                } catch (error) {
                    return { 
                        valid: false, 
                        error: `JSONè§£æå¤±è´¥: ${error.message}` 
                    };
                }
            }
        }

        // æµ‹è¯•é…ç½®
        const testConfig = {
            totalTests: 0,
            passedTests: 0,
            failedTests: 0,
            currentTest: 0,
            startTime: null,
            testResults: [],
            filterManager: null
        };

        // æµ‹è¯•ç”¨ä¾‹å®šä¹‰
        const testSuites = {
            basic: {
                name: 'åŸºç¡€åŠŸèƒ½æµ‹è¯•',
                tests: [
                    {
                        name: 'FilterManageråˆå§‹åŒ–',
                        description: 'éªŒè¯GroupedFilterManageræ­£ç¡®åˆå§‹åŒ–',
                        test: () => {
                            testConfig.filterManager = new GroupedFilterManager();
                            return testConfig.filterManager instanceof GroupedFilterManager;
                        }
                    },
                    {
                        name: 'é»˜è®¤çŠ¶æ€æ£€æŸ¥',
                        description: 'éªŒè¯åˆå§‹çŠ¶æ€æ­£ç¡®',
                        test: () => {
                            const status = testConfig.filterManager.getStatus();
                            return status.enabled === false && 
                                   status.simplifyEnabled === false && 
                                   Array.isArray(status.groups) &&
                                   status.keywordCount === 0;
                        }
                    },
                    {
                        name: 'é…ç½®ä¿å­˜å’ŒåŠ è½½',
                        description: 'éªŒè¯é…ç½®çš„æŒä¹…åŒ–åŠŸèƒ½',
                        test: () => {
                            testConfig.filterManager.setMasterEnabled(true);
                            testConfig.filterManager.saveSettings();
                            
                            const newManager = new GroupedFilterManager();
                            newManager.loadSettings();
                            
                            return newManager.masterEnabled === true;
                        }
                    }
                ]
            },
            groupManagement: {
                name: 'ç»„ç®¡ç†åŠŸèƒ½',
                tests: [
                    {
                        name: 'æ·»åŠ æ–°ç»„',
                        description: 'éªŒè¯æ–°ç»„åˆ›å»ºåŠŸèƒ½',
                        test: () => {
                            const initialCount = testConfig.filterManager.groups.length;
                            const newGroup = testConfig.filterManager.addGroup('æ–°æµ‹è¯•ç»„');
                            
                            return newGroup && 
                                   newGroup.name === 'æ–°æµ‹è¯•ç»„' && 
                                   testConfig.filterManager.groups.length === initialCount + 1;
                        }
                    },
                    {
                        name: 'å¤åˆ¶ç»„',
                        description: 'éªŒè¯ç»„å¤åˆ¶åŠŸèƒ½',
                        test: () => {
                            const sourceGroup = testConfig.filterManager.addGroup('æºç»„');
                            sourceGroup.keywords = ['test1', 'test2'];
                            sourceGroup.replacement = 'replacement';
                            
                            const duplicatedGroup = testConfig.filterManager.duplicateGroup(sourceGroup.id);
                            
                            return duplicatedGroup && 
                                   duplicatedGroup.name === 'æºç»„(å‰¯æœ¬)' &&
                                   duplicatedGroup.keywords.length === 2 &&
                                   duplicatedGroup.replacement === 'replacement';
                        }
                    },
                    {
                        name: 'åˆ é™¤ç»„',
                        description: 'éªŒè¯ç»„åˆ é™¤åŠŸèƒ½',
                        test: () => {
                            const testGroup = testConfig.filterManager.addGroup('å¾…åˆ é™¤ç»„');
                            const initialCount = testConfig.filterManager.groups.length;
                            
                            const result = testConfig.filterManager.deleteGroup(testGroup.id);
                            
                            return result && testConfig.filterManager.groups.length === initialCount - 1;
                        }
                    },
                    {
                        name: 'æ›´æ–°ç»„',
                        description: 'éªŒè¯ç»„ä¿¡æ¯æ›´æ–°åŠŸèƒ½',
                        test: () => {
                            const testGroup = testConfig.filterManager.addGroup('åŸå§‹ç»„å');
                            const result = testConfig.filterManager.updateGroup(testGroup.id, {
                                name: 'æ›´æ–°åçš„ç»„å',
                                enabled: false
                            });
                            
                            const updatedGroup = testConfig.filterManager.getGroup(testGroup.id);
                            
                            return result && 
                                   updatedGroup.name === 'æ›´æ–°åçš„ç»„å' &&
                                   updatedGroup.enabled === false;
                        }
                    },
                    {
                        name: 'ç»„æ’åº',
                        description: 'éªŒè¯ç»„é¡ºåºè°ƒæ•´åŠŸèƒ½',
                        test: () => {
                            testConfig.filterManager.groups = [];
                            const group1 = testConfig.filterManager.addGroup('ç»„1');
                            const group2 = testConfig.filterManager.addGroup('ç»„2');
                            const group3 = testConfig.filterManager.addGroup('ç»„3');
                            
                            testConfig.filterManager.reorderGroups([group3.id, group1.id, group2.id]);
                            
                            return testConfig.filterManager.groups[0].id === group3.id &&
                                   testConfig.filterManager.groups[1].id === group1.id &&
                                   testConfig.filterManager.groups[2].id === group2.id;
                        }
                    }
                ]
            },
            filterAlgorithm: {
                name: 'è¿‡æ»¤ç®—æ³•æµ‹è¯•',
                tests: [
                    {
                        name: 'å•ç»„åŸºç¡€è¿‡æ»¤',
                        description: 'éªŒè¯å•ä¸ªç»„çš„åŸºç¡€è¿‡æ»¤åŠŸèƒ½',
                        test: () => {
                            testConfig.filterManager.groups = [];
                            const testGroup = testConfig.filterManager.addGroup('æµ‹è¯•è¿‡æ»¤');
                            testGroup.keywords = ['nsfw', 'watermark'];
                            
                            testConfig.filterManager.setMasterEnabled(true);
                            
                            const input = ['1girl', 'nsfw', 'watermark', 'best quality'];
                            const result = testConfig.filterManager.applyFilter(input);
                            
                            return result.includes('1girl') && 
                                   result.includes('best quality') &&
                                   !result.includes('nsfw') && 
                                   !result.includes('watermark');
                        }
                    },
                    {
                        name: 'æ›¿æ¢çŸ­è¯­åŠŸèƒ½',
                        description: 'éªŒè¯æ›¿æ¢çŸ­è¯­æ­£ç¡®æ’å…¥',
                        test: () => {
                            testConfig.filterManager.groups = [];
                            const testGroup = testConfig.filterManager.addGroup('æ›¿æ¢æµ‹è¯•');
                            testGroup.keywords = ['nsfw'];
                            testGroup.replacement = 'sfw, safe';
                            
                            testConfig.filterManager.setMasterEnabled(true);
                            
                            const input = ['1girl', 'nsfw', 'best quality'];
                            const result = testConfig.filterManager.applyFilter(input);
                            
                            return result.includes('1girl') && 
                                   result.includes('sfw') && 
                                   result.includes('safe') && 
                                   result.includes('best quality') &&
                                   !result.includes('nsfw');
                        }
                    },
                    {
                        name: 'å¤šç»„é¡ºåºå¤„ç†',
                        description: 'éªŒè¯å¤šç»„æŒ‰é¡ºåºæ‰§è¡Œ',
                        test: () => {
                            testConfig.filterManager.groups = [];
                            
                            const group1 = testConfig.filterManager.addGroup('ç»„1');
                            group1.keywords = ['nsfw'];
                            group1.replacement = 'sfw';
                            
                            const group2 = testConfig.filterManager.addGroup('ç»„2');
                            group2.keywords = ['sfw'];
                            group2.replacement = 'safe';
                            
                            testConfig.filterManager.setMasterEnabled(true);
                            
                            const input = ['1girl', 'nsfw'];
                            const result = testConfig.filterManager.applyFilter(input);
                            
                            return result.includes('1girl') && 
                                   result.includes('safe') &&
                                   !result.includes('nsfw') && 
                                   !result.includes('sfw');
                        }
                    },
                    {
                        name: 'æ­£åˆ™è¡¨è¾¾å¼æ”¯æŒ',
                        description: 'éªŒè¯æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…åŠŸèƒ½',
                        test: () => {
                            testConfig.filterManager.groups = [];
                            const testGroup = testConfig.filterManager.addGroup('æ­£åˆ™æµ‹è¯•');
                            testGroup.keywords = ['\\d+px', 'bad.*quality'];
                            
                            testConfig.filterManager.setMasterEnabled(true);
                            
                            const input = ['1girl', '1024px', 'bad quality', 'masterpiece'];
                            const result = testConfig.filterManager.applyFilter(input);
                            
                            return result.includes('1girl') && 
                                   result.includes('masterpiece') &&
                                   !result.includes('1024px') && 
                                   !result.includes('bad quality');
                        }
                    },
                    {
                        name: 'å‘½ä¸­è®¡æ•°ç»Ÿè®¡',
                        description: 'éªŒè¯å‘½ä¸­è®¡æ•°æ­£ç¡®è®°å½•',
                        test: () => {
                            testConfig.filterManager.groups = [];
                            const testGroup = testConfig.filterManager.addGroup('è®¡æ•°æµ‹è¯•');
                            testGroup.keywords = ['test'];
                            
                            testConfig.filterManager.setMasterEnabled(true);
                            
                            const input = ['test', '1girl', 'test', 'quality'];
                            testConfig.filterManager.applyFilter(input);
                            
                            return testGroup.meta.lastMatchCount === 2;
                        }
                    }
                ]
            },
            simplification: {
                name: 'æç¤ºè¯ç®€åŒ–æµ‹è¯•',
                tests: [
                    {
                        name: 'ç®€åŒ–åŠŸèƒ½å¼€å…³',
                        description: 'éªŒè¯ç®€åŒ–åŠŸèƒ½å¼€å…³æ§åˆ¶',
                        test: () => {
                            testConfig.filterManager.setMasterEnabled(true);
                            testConfig.filterManager.setSimplifyEnabled(true);
                            
                            const input = ['hat', 'red hat', 'girl', 'beautiful girl'];
                            const result = testConfig.filterManager.applyFilter(input);
                            
                            return result.includes('red hat') && 
                                   result.includes('beautiful girl') &&
                                   !result.includes('hat') && 
                                   !result.includes('girl');
                        }
                    },
                    {
                        name: 'ç®€åŒ–ç»Ÿè®¡è®¡æ•°',
                        description: 'éªŒè¯ç®€åŒ–ç§»é™¤è®¡æ•°æ­£ç¡®',
                        test: () => {
                            testConfig.filterManager.groups = [];
                            testConfig.filterManager.setMasterEnabled(true);
                            testConfig.filterManager.setSimplifyEnabled(true);
                            
                            const input = ['hat', 'red hat', 'girl', 'beautiful girl', 'quality', 'best quality'];
                            testConfig.filterManager.applyFilter(input);
                            
                            return testConfig.filterManager.lastSimplifiedCount === 3;
                        }
                    }
                ]
            },
            importExport: {
                name: 'å¯¼å…¥å¯¼å‡ºæµ‹è¯•',
                tests: [
                    {
                        name: 'é…ç½®å¯¼å‡º',
                        description: 'éªŒè¯é…ç½®å¯¼å‡ºåŠŸèƒ½',
                        test: () => {
                            testConfig.filterManager.groups = [];
                            testConfig.filterManager.addGroup('å¯¼å‡ºæµ‹è¯•ç»„');
                            
                            const exported = testConfig.filterManager.exportConfig();
                            const config = JSON.parse(exported);
                            
                            return config.schemaVersion === 1 && 
                                   Array.isArray(config.groups) && 
                                   config.groups.length > 0 &&
                                   config.groups[0].name === 'å¯¼å‡ºæµ‹è¯•ç»„';
                        }
                    },
                    {
                        name: 'é…ç½®å¯¼å…¥éªŒè¯',
                        description: 'éªŒè¯é…ç½®å¯¼å…¥éªŒè¯åŠŸèƒ½',
                        test: () => {
                            const validConfig = {
                                masterEnabled: true,
                                simplifyEnabled: false,
                                groups: [
                                    {
                                        id: 'test-id',
                                        name: 'å¯¼å…¥æµ‹è¯•',
                                        enabled: true,
                                        collapsed: true,
                                        keywords: ['test'],
                                        replacement: ''
                                    }
                                ],
                                schemaVersion: 1
                            };
                            
                            const validation = testConfig.filterManager.validateImportConfig(validConfig);
                            return validation.valid === true;
                        }
                    },
                    {
                        name: 'é…ç½®å¯¼å…¥åº”ç”¨',
                        description: 'éªŒè¯é…ç½®å¯¼å…¥å¹¶åº”ç”¨åŠŸèƒ½',
                        test: () => {
                            const testConfigData = {
                                masterEnabled: true,
                                simplifyEnabled: false,
                                groups: [
                                    {
                                        id: 'imported-group',
                                        name: 'å¯¼å…¥çš„ç»„',
                                        enabled: true,
                                        collapsed: true,
                                        keywords: ['imported'],
                                        replacement: 'processed'
                                    }
                                ],
                                schemaVersion: 1
                            };
                            
                            const result = testConfig.filterManager.importConfig(JSON.stringify(testConfigData), false);
                            const importedGroup = testConfig.filterManager.groups.find(g => g.name === 'å¯¼å…¥çš„ç»„');
                            
                            return result.success && importedGroup && importedGroup.keywords.includes('imported');
                        }
                    }
                ]
            },
            validation: {
                name: 'æ•°æ®éªŒè¯æµ‹è¯•',
                tests: [
                    {
                        name: 'æ›¿æ¢çŸ­è¯­æ ¼å¼éªŒè¯',
                        description: 'éªŒè¯æ›¿æ¢çŸ­è¯­æ ¼å¼æ£€æŸ¥',
                        test: () => {
                            const validReplacement = 'tag1, tag2, tag3';
                            const invalidReplacement = 'tag1,tag2,tag3';
                            
                            const validResult = testConfig.filterManager._isValidReplacement(validReplacement);
                            const invalidResult = testConfig.filterManager._isValidReplacement(invalidReplacement);
                            
                            return validResult === true && invalidResult === false;
                        }
                    },
                    {
                        name: 'æ›¿æ¢çŸ­è¯­è§£æ',
                        description: 'éªŒè¯æ›¿æ¢çŸ­è¯­æ­£ç¡®è§£æ',
                        test: () => {
                            const replacement = 'tag1, tag2, tag3';
                            const parsed = testConfig.filterManager._parseReplacementString(replacement);
                            
                            return Array.isArray(parsed) && 
                                   parsed.length === 3 && 
                                   parsed.includes('tag1') && 
                                   parsed.includes('tag2') && 
                                   parsed.includes('tag3');
                        }
                    },
                    {
                        name: 'å»é‡åŠŸèƒ½',
                        description: 'éªŒè¯æ•°ç»„å»é‡åŠŸèƒ½',
                        test: () => {
                            const input = ['tag1', 'tag2', 'tag1', 'tag3', 'tag2'];
                            const result = testConfig.filterManager._dedupeKeepFirst(input);
                            
                            return result.length === 3 && 
                                   result[0] === 'tag1' && 
                                   result[1] === 'tag2' && 
                                   result[2] === 'tag3';
                        }
                    }
                ]
            },
            integration: {
                name: 'é›†æˆæµ‹è¯•',
                tests: [
                    {
                        name: 'å®Œæ•´è¿‡æ»¤æµç¨‹',
                        description: 'éªŒè¯å®Œæ•´çš„åˆ†ç»„è¿‡æ»¤æµç¨‹',
                        test: () => {
                            testConfig.filterManager.groups = [];
                            const filterGroup = testConfig.filterManager.addGroup('å†…å®¹è¿‡æ»¤');
                            filterGroup.keywords = ['nsfw', 'watermark'];
                            filterGroup.replacement = 'sfw';
                            
                            testConfig.filterManager.setMasterEnabled(true);
                            testConfig.filterManager.setSimplifyEnabled(true);
                            
                            const input = ['1girl', 'long hair', 'hat', 'red hat', 'nsfw', 'watermark'];
                            const result = testConfig.filterManager.applyFilter(input);
                            
                            return Array.isArray(result) && 
                                   result.includes('1girl') && 
                                   result.includes('long hair') && 
                                   result.includes('red hat') && 
                                   result.includes('sfw') && 
                                   !result.includes('hat') && 
                                   !result.includes('nsfw') && 
                                   !result.includes('watermark');
                        }
                    },
                    {
                        name: 'æ€»å¼€å…³æ§åˆ¶',
                        description: 'éªŒè¯æ€»å¼€å…³å¯¹æ‰€æœ‰åŠŸèƒ½çš„æ§åˆ¶',
                        test: () => {
                            testConfig.filterManager.groups = [];
                            const filterGroup = testConfig.filterManager.addGroup('æµ‹è¯•ç»„');
                            filterGroup.keywords = ['test'];
                            
                            testConfig.filterManager.setMasterEnabled(false);
                            testConfig.filterManager.setSimplifyEnabled(true);
                            
                            const input = ['test', 'hat', 'red hat'];
                            const result = testConfig.filterManager.applyFilter(input);
                            
                            return result.length === input.length && 
                                   result.includes('test') && 
                                   result.includes('hat') && 
                                   result.includes('red hat');
                        }
                    }
                ]
            }
        };

        // æµ‹è¯•æ‰§è¡Œå‡½æ•°
        async function runTestSuite(suiteName) {
            const suite = testSuites[suiteName];
            if (!suite) return;

            const sectionDiv = createTestSection(suite.name);
            
            for (const testCase of suite.tests) {
                const caseDiv = createTestCase(testCase.name, testCase.description);
                sectionDiv.appendChild(caseDiv);
                
                testConfig.currentTest++;
                updateProgress();
                
                try {
                    caseDiv.className += ' running';
                    await new Promise(resolve => setTimeout(resolve, 100));
                    
                    const result = testCase.test();
                    
                    if (result) {
                        caseDiv.className = caseDiv.className.replace(' running', ' passed');
                        testConfig.passedTests++;
                        
                        const output = document.createElement('div');
                        output.className = 'test-result success';
                        output.textContent = 'âœ… æµ‹è¯•é€šè¿‡';
                        caseDiv.appendChild(output);
                    } else {
                        throw new Error('æµ‹è¯•æ¡ä»¶ä¸æ»¡è¶³');
                    }
                } catch (error) {
                    caseDiv.className = caseDiv.className.replace(' running', ' failed');
                    testConfig.failedTests++;
                    
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'test-result error';
                    errorDiv.textContent = `âŒ ${error.message}`;
                    caseDiv.appendChild(errorDiv);
                }
                
                testConfig.testResults.push({
                    suite: suite.name,
                    test: testCase.name,
                    passed: caseDiv.classList.contains('passed'),
                    error: caseDiv.classList.contains('failed') ? caseDiv.querySelector('.test-result.error')?.textContent.replace('âŒ ', '') : null
                });
                
                updateStats();
                await new Promise(resolve => setTimeout(resolve, 50));
            }
        }

        function createTestSection(name) {
            const sectionsContainer = document.getElementById('test-sections');
            
            const section = document.createElement('div');
            section.className = 'test-section';
            section.innerHTML = `<h3 class="section-title">${name}</h3>`;
            
            sectionsContainer.appendChild(section);
            return section;
        }

        function createTestCase(name, description) {
            const caseDiv = document.createElement('div');
            caseDiv.className = 'test-case';
            
            const nameDiv = document.createElement('div');
            nameDiv.className = 'test-name';
            nameDiv.textContent = name;
            caseDiv.appendChild(nameDiv);
            
            const descDiv = document.createElement('div');
            descDiv.className = 'test-description';
            descDiv.textContent = description;
            caseDiv.appendChild(descDiv);
            
            return caseDiv;
        }

        function updateStats() {
            document.getElementById('total-tests').textContent = testConfig.currentTest;
            document.getElementById('passed-tests').textContent = testConfig.passedTests;
            document.getElementById('failed-tests').textContent = testConfig.failedTests;
            
            const successRate = testConfig.currentTest > 0 
                ? Math.round((testConfig.passedTests / testConfig.currentTest) * 100)
                : 0;
            document.getElementById('success-rate').textContent = successRate + '%';
            
            const duration = testConfig.startTime ? (Date.now() - testConfig.startTime) / 1000 : 0;
            document.getElementById('duration').textContent = duration.toFixed(1) + 's';
        }

        function updateProgress() {
            const totalTests = Object.values(testSuites).reduce((sum, suite) => sum + suite.tests.length, 0);
            const progress = (testConfig.currentTest / totalTests) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';
            document.getElementById('progress-text').textContent = `è¿›åº¦: ${testConfig.currentTest}/${totalTests} (${progress.toFixed(1)}%)`;
        }

        function updateOverallStatus(status) {
            const statusEl = document.getElementById('overall-status');
            statusEl.textContent = status;
            statusEl.className = `test-status status-${status.toLowerCase().replace(/\s+/g, '-')}`;
        }

        // ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
        function generatePlaintextReport() {
            const duration = (Date.now() - testConfig.startTime) / 1000;
            const successRate = Math.round((testConfig.passedTests / testConfig.currentTest) * 100);
            
            let report = '';
            report += '='.repeat(60) + '\n';
            report += 'åˆ†ç»„è¿‡æ»¤å™¨åŠŸèƒ½æµ‹è¯•æŠ¥å‘Š\n';
            report += '='.repeat(60) + '\n';
            report += `æµ‹è¯•æ—¶é—´: ${new Date().toLocaleString()}\n`;
            report += `æµ‹è¯•è€—æ—¶: ${duration.toFixed(2)}ç§’\n`;
            report += '\n';
            
            // æ±‡æ€»ç»Ÿè®¡
            report += 'æµ‹è¯•æ±‡æ€»:\n';
            report += '-'.repeat(30) + '\n';
            report += `æ€»æµ‹è¯•æ•°: ${testConfig.currentTest}\n`;
            report += `é€šè¿‡æ•°é‡: ${testConfig.passedTests}\n`;
            report += `å¤±è´¥æ•°é‡: ${testConfig.failedTests}\n`;
            report += `æˆåŠŸç‡: ${successRate}%\n`;
            report += '\n';
            
            // æŒ‰æµ‹è¯•å¥—ä»¶åˆ†ç»„
            const suiteResults = {};
            testConfig.testResults.forEach(result => {
                if (!suiteResults[result.suite]) {
                    suiteResults[result.suite] = { passed: 0, failed: 0, tests: [] };
                }
                if (result.passed) {
                    suiteResults[result.suite].passed++;
                } else {
                    suiteResults[result.suite].failed++;
                }
                suiteResults[result.suite].tests.push(result);
            });
            
            // è¯¦ç»†ç»“æœ
            report += 'è¯¦ç»†æµ‹è¯•ç»“æœ:\n';
            report += '-'.repeat(30) + '\n';
            
            Object.keys(suiteResults).forEach(suiteName => {
                const suite = suiteResults[suiteName];
                const suiteRate = Math.round((suite.passed / (suite.passed + suite.failed)) * 100);
                
                report += `\nã€${suiteName}ã€‘ (${suite.passed + suite.failed}ä¸ªæµ‹è¯•, æˆåŠŸç‡: ${suiteRate}%)\n`;
                
                suite.tests.forEach(test => {
                    const status = test.passed ? 'âœ… PASS' : 'âŒ FAIL';
                    report += `  ${status} ${test.test}`;
                    if (test.error) {
                        report += `\n       é”™è¯¯: ${test.error}`;
                    }
                    report += '\n';
                });
            });
            
            // å¤±è´¥æ±‡æ€»
            const failedTests = testConfig.testResults.filter(r => !r.passed);
            if (failedTests.length > 0) {
                report += '\nå¤±è´¥æµ‹è¯•æ±‡æ€»:\n';
                report += '-'.repeat(30) + '\n';
                failedTests.forEach(test => {
                    report += `â€¢ [${test.suite}] ${test.test}\n`;
                    report += `  é”™è¯¯: ${test.error}\n\n`;
                });
            }
            
            // æ€»ç»“
            report += '\næµ‹è¯•æ€»ç»“:\n';
            report += '-'.repeat(30) + '\n';
            if (successRate === 100) {
                report += 'ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼åˆ†ç»„è¿‡æ»¤å™¨åŠŸèƒ½å®Œå…¨æ­£å¸¸ã€‚\n';
            } else if (successRate >= 90) {
                report += 'âš ï¸  å¤§éƒ¨åˆ†æµ‹è¯•é€šè¿‡ï¼Œä½†å­˜åœ¨å°‘é‡é—®é¢˜éœ€è¦ä¿®å¤ã€‚\n';
            } else if (successRate >= 70) {
                report += 'ğŸ”§ éƒ¨åˆ†æµ‹è¯•é€šè¿‡ï¼Œå­˜åœ¨ä¸€äº›éœ€è¦ä¿®å¤çš„é—®é¢˜ã€‚\n';
            } else {
                report += 'ğŸš¨ æµ‹è¯•å¤±è´¥ç‡è¾ƒé«˜ï¼Œéœ€è¦é‡ç‚¹æ£€æŸ¥å’Œä¿®å¤åŠŸèƒ½ã€‚\n';
            }
            
            // åŠŸèƒ½è¦†ç›–åº¦
            report += '\nåŠŸèƒ½è¦†ç›–åº¦:\n';
            report += '-'.repeat(30) + '\n';
            report += 'âœ“ ç»„ç®¡ç†åŠŸèƒ½ (å¢åˆ æ”¹æŸ¥ã€æ’åº)\n';
            report += 'âœ“ åˆ†ç»„è¿‡æ»¤ç®—æ³• (å•ç»„ã€å¤šç»„ã€æ­£åˆ™)\n';
            report += 'âœ“ æ›¿æ¢çŸ­è¯­åŠŸèƒ½\n';
            report += 'âœ“ æç¤ºè¯ç®€åŒ–\n';
            report += 'âœ“ å¯¼å…¥å¯¼å‡ºé…ç½®\n';
            report += 'âœ“ æ•°æ®éªŒè¯å’Œé”™è¯¯å¤„ç†\n';
            report += 'âœ“ é›†æˆåŠŸèƒ½æµ‹è¯•\n';
            
            report += '\n' + '='.repeat(60) + '\n';
            report += 'æŠ¥å‘Šç»“æŸ\n';
            report += '='.repeat(60);
            
            return report;
        }

        function displayReport() {
            const report = generatePlaintextReport();
            document.getElementById('report-content').textContent = report;
            document.getElementById('report-section').style.display = 'block';
        }

        function copyReport() {
            const reportContent = document.getElementById('report-content').textContent;
            navigator.clipboard.writeText(reportContent).then(() => {
                const btn = document.querySelector('.copy-button');
                const originalText = btn.textContent;
                btn.textContent = 'âœ… å·²å¤åˆ¶';
                setTimeout(() => {
                    btn.textContent = originalText;
                }, 2000);
            });
        }

        // è‡ªåŠ¨è¿è¡Œæ‰€æœ‰æµ‹è¯•
        async function runAllTests() {
            testConfig.startTime = Date.now();
            updateOverallStatus('è¿è¡Œä¸­');
            
            try {
                const suiteNames = Object.keys(testSuites);
                for (const suiteName of suiteNames) {
                    await runTestSuite(suiteName);
                }
                
                const success = testConfig.failedTests === 0;
                updateOverallStatus(success ? 'å…¨éƒ¨é€šè¿‡' : 'éƒ¨åˆ†å¤±è´¥');
                
                // æ˜¾ç¤ºæµ‹è¯•æŠ¥å‘Š
                displayReport();
                
            } catch (error) {
                updateOverallStatus('è¿è¡Œå¤±è´¥');
                console.error('æµ‹è¯•è¿è¡Œå‡ºé”™:', error);
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨å¼€å§‹æµ‹è¯•
        document.addEventListener('DOMContentLoaded', function() {
            console.log('æµ‹è¯•é¡µé¢å·²åŠ è½½ï¼Œå¼€å§‹è‡ªåŠ¨æµ‹è¯•...');
            
            // è®¡ç®—æ€»æµ‹è¯•æ•°å¹¶æ˜¾ç¤º
            const totalTests = Object.values(testSuites).reduce((sum, suite) => sum + suite.tests.length, 0);
            document.getElementById('total-tests').textContent = totalTests;
            
            // å»¶è¿Ÿ500msåå¼€å§‹æµ‹è¯•ï¼Œç¡®ä¿é¡µé¢å®Œå…¨æ¸²æŸ“
            setTimeout(() => {
                runAllTests();
            }, 500);
        });
    </script>
</body>
</html>