<!-- index.html -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tagæ ¼å¼è½¬æ¢å™¨ - æ”¯æŒDanbooru/Gelbooruå¤šæ ¼å¼è½¬æ¢</title>
    <meta name="description" content="æ™ºèƒ½Tagæ ¼å¼è½¬æ¢å™¨ï¼Œæ”¯æŒDanbooruå’ŒGelbooruæ ¼å¼è‡ªåŠ¨è¯†åˆ«å’Œè½¬æ¢ï¼Œå®æ—¶å¤„ç†ï¼Œä¸€é”®å¤åˆ¶">
    <meta name="keywords" content="Tagè½¬æ¢å™¨,Danbooru,Gelbooru,æç¤ºè¯,AIç»˜å›¾">
    
    <style>
        /* =================================
           åŸºç¡€æ ·å¼ä¸å¸ƒå±€
           ================================= */
        
        /* å…¨å±€å­—ä½“å’Œå¸ƒå±€è®¾ç½® */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            max-width: 900px;
            margin: 2rem auto;
            padding: 0 1rem;
            line-height: 1.6;
            color: #333;
            background-color: #fafafa;
        }
        
        /* ä¸»å®¹å™¨æ ·å¼ */
        .container {
            background: #ffffff;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.3s ease;
        }
        
        .container:hover {
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
        }
        
        /* æ ‡é¢˜æ ·å¼ */
        h1 {
            text-align: center;
            color: #1d1d1f;
            font-weight: 700;
            margin-bottom: 0.5rem;
            font-size: 2.2rem;
        }
        
        .subtitle {
            text-align: center;
            color: #86868b;
            font-size: 1rem;
            margin-bottom: 2rem;
        }
        
        /* =================================
           è¾“å…¥è¾“å‡ºåŒºåŸŸæ ·å¼
           ================================= */
        
        /* è¾“å…¥æ–‡æœ¬æ¡†æ ·å¼ */
        .input-section {
            margin-bottom: 1.5rem;
        }
        
        .input-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #1d1d1f;
        }
        
        textarea {
            width: 100%;
            height: 300px;
            padding: 16px;
            border: 2px solid #e5e5e7;
            border-radius: 12px;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;
            font-size: 14px;
            line-height: 1.5;
            resize: vertical;
            transition: border-color 0.2s ease;
            box-sizing: border-box;
        }
        
        textarea:focus {
            outline: none;
            border-color: #007AFF;
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }
        
        /* æŒ‰é’®ç»„æ ·å¼ */
        .button-group {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        button {
            background: #007AFF;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
            min-width: 120px;
        }
        
        button:hover {
            background: #0056CC;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button.secondary {
            background: #f2f2f7;
            color: #1d1d1f;
        }
        
        button.secondary:hover {
            background: #e5e5ea;
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        
        button.secondary:disabled:hover {
            background: #f2f2f7;
        }
        
        /* è¾“å‡ºåŒºåŸŸæ ·å¼ */
        .output-section {
            margin-top: 1.5rem;
        }
        
        .output-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #1d1d1f;
        }
        
        #output {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 16px;
            min-height: 100px;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: #495057;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        #output.has-content {
            background: #e8f5e8;
            border-color: #28a745;
            color: #155724;
            text-align: left;
            justify-content: flex-start;
        }
        
        /* çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .status-indicator {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .status-indicator.detected {
            background: #e3f2fd;
            color: #1976d2;
        }
        
        /* =================================
           è‡ªå®šä¹‰è¿‡æ»¤å™¨æ ·å¼
           ================================= */
        
        .filter-section {
            margin-top: 2rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 12px;
            border: 1px solid #e9ecef;
        }
        
        .filter-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }
        
        .filter-title {
            font-weight: 600;
            color: #1d1d1f;
            font-size: 1.1rem;
        }
        
        .filter-toggle {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .filter-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.3s;
            border-radius: 30px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #007AFF;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }
        
        .filter-input-group {
            margin-bottom: 1rem;
        }
        
        .filter-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e5e7;
            border-radius: 8px;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;
            font-size: 14px;
            transition: border-color 0.2s ease;
            box-sizing: border-box;
        }
        
        .filter-input:focus {
            outline: none;
            border-color: #007AFF;
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }
        
        .filter-help {
            font-size: 12px;
            color: #666;
            margin-top: 0.5rem;
            line-height: 1.4;
        }
        
        .filter-stats {
            display: flex;
            gap: 1rem;
            font-size: 12px;
            color: #666;
            margin-top: 1rem;
        }
        
        .filter-stat {
            background: #fff;
            padding: 6px 12px;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }
        
        .filter-collapsed {
            display: none;
        }
        
        .filter-section.collapsed .filter-collapsed {
            display: none;
        }
        
        .expand-button {
            background: none;
            border: none;
            color: #007AFF;
            cursor: pointer;
            font-size: 14px;
            padding: 4px 8px;
            min-width: auto;
        }
        
        .expand-button:hover {
            background: rgba(0, 122, 255, 0.1);
            transform: none;
            box-shadow: none;
        }
        
        /* =================================
           å“åº”å¼è®¾è®¡
           ================================= */
        
        @media (max-width: 768px) {
            body {
                margin: 1rem auto;
                padding: 0 0.5rem;
            }
            
            .container {
                padding: 1.5rem;
                border-radius: 12px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            textarea {
                height: 250px;
                padding: 12px;
            }
            
            .button-group {
                flex-direction: column;
                align-items: center;
            }
            
            button {
                width: 100%;
                max-width: 200px;
            }
        }
        
        /* =================================
           å·¥å…·æç¤ºå’ŒåŠ¨ç”»
           ================================= */
        
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }
        
        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid #ccc;
            border-top: 2px solid #007AFF;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡µé¢æ ‡é¢˜åŒºåŸŸ -->
        <header>
            <h1>Tagæ ¼å¼è½¬æ¢å™¨</h1>
            <p class="subtitle">æ”¯æŒDanbooruã€Gelbooruå¤šæ ¼å¼æ™ºèƒ½è½¬æ¢ã€å®æ—¶å¤„ç†å’Œä¸€é”®å¤åˆ¶</p>
        </header>
        
        <!-- è¾“å…¥åŒºåŸŸ -->
        <section class="input-section">
            <label for="input" class="input-label">è¾“å…¥åŸå§‹Tagæ–‡æœ¬</label>
            <textarea 
                id="input" 
                placeholder="è¯·ç²˜è´´æ¥è‡ªDanbooruæˆ–Gelbooruçš„åŸå§‹tagæ–‡æœ¬...&#10;&#10;æ”¯æŒæ ¼å¼ï¼š&#10;â€¢ Danbooru: æ¢è¡Œç¬¦+?æ ‡è®°æ ¼å¼&#10;â€¢ Gelbooru: Artist?/Tag?è¿ç»­æ ¼å¼&#10;â€¢ Standard: é€—å·åˆ†éš”æ ‡å‡†æ ¼å¼"
                aria-describedby="input-help"></textarea>
            <div id="format-status" class="status-indicator" style="display: none;"></div>
        </section>
        
        <!-- æ“ä½œæŒ‰é’®ç»„ -->
        <section class="button-group">
            <button 
                onclick="loadExample()" 
                class="secondary tooltip" 
                data-tooltip="å¾ªç¯åŠ è½½ä¸åŒæ ¼å¼çš„ç¤ºä¾‹æ•°æ®"
                id="load-example-btn">
                ğŸ“ åŠ è½½ç¤ºä¾‹
            </button>
            <button 
                onclick="clearAll()" 
                class="secondary tooltip" 
                data-tooltip="æ¸…ç©ºè¾“å…¥å’Œè¾“å‡ºå†…å®¹">
                ğŸ—‘ï¸ æ¸…ç©ºå†…å®¹
            </button>
            <button 
                onclick="copyOutput(this)" 
                class="tooltip" 
                data-tooltip="å¤åˆ¶è½¬æ¢ç»“æœåˆ°å‰ªè´´æ¿">
                ğŸ“‹ å¤åˆ¶ç»“æœ
            </button>
        </section>
        
        <!-- è‡ªå®šä¹‰è¿‡æ»¤å™¨åŒºåŸŸ -->
        <section class="filter-section" id="filter-section">
            <div class="filter-header">
                <div class="filter-title">ğŸ¯ è‡ªå®šä¹‰è¿‡æ»¤å™¨</div>
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <button class="expand-button" id="filter-expand" onclick="toggleFilterSection()">
                        å±•å¼€è®¾ç½®
                    </button>
                    <label class="filter-toggle">
                        <input type="checkbox" id="filter-enabled" onchange="toggleFilter()">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
            
            <div class="filter-collapsed" id="filter-content">
                <div class="filter-input-group">
                    <input 
                        type="text" 
                        class="filter-input" 
                        id="filter-keywords" 
                        placeholder="è¾“å…¥è¦è¿‡æ»¤çš„å…³é”®è¯ï¼Œç”¨é€—å·åˆ†éš”ï¼ˆæ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ï¼‰"
                        onchange="updateFilterKeywords()">
                    <div class="filter-help">
                        ç¤ºä¾‹: "watermark, nsfw, bad quality, beautiful girl, \d+px" <br>
                        â€¢ æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼åŒ¹é… <br>
                        â€¢ é€—å·åˆ†éš”å¤šä¸ªè¿‡æ»¤è¯ <br>
                        â€¢ æ”¯æŒå«ç©ºæ ¼çš„è¯ç»„è¿‡æ»¤ <br>
                        â€¢ è¿‡æ»¤åœ¨æ ¼å¼åŒ–å®Œæˆååº”ç”¨
                    </div>
                </div>
                
                <div class="filter-stats">
                    <div class="filter-stat">
                        è¿‡æ»¤è§„åˆ™: <span id="filter-count">0</span>ä¸ª
                    </div>
                    <div class="filter-stat">
                        ä¸Šæ¬¡è¿‡æ»¤: <span id="filtered-count">0</span>ä¸ªæ ‡ç­¾
                    </div>
                </div>
            </div>
        </section>
        
        <!-- è¾“å‡ºåŒºåŸŸ -->
        <section class="output-section">
            <label for="output" class="output-label">è½¬æ¢ç»“æœ</label>
            <div 
                id="output" 
                aria-live="polite" 
                aria-label="è½¬æ¢ç»“æœè¾“å‡ºåŒºåŸŸ">ç­‰å¾…è¾“å…¥å†…å®¹è¿›è¡Œè½¬æ¢...
            </div>
        </section>
    </div>

    <script>
        /**
         * ====================================================================
         * Tagæ ¼å¼è½¬æ¢å™¨ - ç»Ÿä¸€å¤„ç†ç®—æ³• + è‡ªå®šä¹‰è¿‡æ»¤ç³»ç»Ÿ
         * ====================================================================
         * 
         * åŠŸèƒ½æ¦‚è¿°ï¼š
         * - æ”¯æŒDanbooruã€Gelbooruã€Standardä¸‰ç§æ ¼å¼çš„æ™ºèƒ½è¯†åˆ«å’Œè½¬æ¢
         * - é‡‡ç”¨å››é˜¶æ®µå¤„ç†æµç¨‹ï¼šæ ¼å¼æ£€æµ‹ â†’ å†…å®¹æå– â†’ ç»Ÿä¸€æ¸…ç† â†’ è‡ªå®šä¹‰è¿‡æ»¤
         * - ä¿æŠ¤è¯ç»„å®Œæ•´æ€§ï¼Œé˜²æ­¢å¤åˆè¯ç»„è¢«é”™è¯¯åˆ†å‰²
         * - è‡ªå®šä¹‰è¿‡æ»¤å™¨æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼å’Œè¯ç»„è¿‡æ»¤
         * - å®æ—¶è½¬æ¢ï¼Œç”¨æˆ·ä½“éªŒå‹å¥½ï¼Œè®¾ç½®æŒä¹…åŒ–å­˜å‚¨
         * - æ™ºèƒ½çŠ¶æ€ç®¡ç†ï¼ŒåŒ…æ‹¬ç©ºè¾“å…¥æ—¶çš„çŠ¶æ€é‡ç½®
         * 
         * æ¶æ„è®¾è®¡ï¼š
         * - TagConverter: ä¸»æ§åˆ¶å™¨ç±»ï¼Œç»Ÿç­¹æ•´ä¸ªè½¬æ¢æµç¨‹
         * - FormatDetector: æ ¼å¼æ£€æµ‹æ¨¡å—ï¼Œæ™ºèƒ½è¯†åˆ«è¾“å…¥æ ¼å¼
         * - ContentExtractor: å†…å®¹æå–æ¨¡å—ï¼ŒæŒ‰æ ¼å¼æå–æœ‰æ•ˆå†…å®¹
         * - ContentCleaner: å†…å®¹æ¸…ç†æ¨¡å—ï¼Œæ ‡å‡†åŒ–å’Œå»é‡å¤„ç†
         * - FilterManager: è¿‡æ»¤å™¨ç®¡ç†æ¨¡å—ï¼Œè‡ªå®šä¹‰å…³é”®è¯è¿‡æ»¤
         * - UIManager: ç”¨æˆ·ç•Œé¢ç®¡ç†æ¨¡å—ï¼Œç»Ÿä¸€UIäº¤äº’é€»è¾‘
         * - ExampleManager: ç¤ºä¾‹æ•°æ®ç®¡ç†ï¼Œé˜²é‡å¤åŠ è½½å’Œç‚¹å‡»å†²çª
         * 
         * ç‰ˆæœ¬å†å²ï¼š
         * - v1.0: åŸºç¡€Danbooruæ ¼å¼æ”¯æŒ
         * - v2.0: æ·»åŠ Gelbooruæ ¼å¼æ”¯æŒå’Œç»Ÿä¸€ç®—æ³•
         * - v3.0: å®Œæ•´æ¶æ„é‡æ„å’Œç°ä»£åŒ–UI
         * - v4.0: è‡ªå®šä¹‰è¿‡æ»¤å™¨ç³»ç»Ÿ
         * - v4.1: ç¤ºä¾‹ç®¡ç†å™¨å’ŒçŠ¶æ€é‡ç½®ä¼˜åŒ–ï¼ˆå½“å‰ç‰ˆæœ¬ï¼‰
         */

        // ====================================================================
        // å¸¸é‡å®šä¹‰å’Œé…ç½®
        // ====================================================================
        
        const CONFIG = {
            // æ”¯æŒçš„æ ¼å¼ç±»å‹
            FORMATS: {
                DANBOORU: 'danbooru',    // Danbooruæ ¼å¼ï¼šæ¢è¡Œç¬¦+?æ ‡è®°
                GELBOORU: 'gelbooru',    // Gelbooruæ ¼å¼ï¼šArtist?/Tag?è¿ç»­æ ¼å¼  
                STANDARD: 'standard'     // æ ‡å‡†æ ¼å¼ï¼šé€—å·åˆ†éš”
            },
            
            // åˆ†ç±»æ ‡è¯†ç¬¦å®šä¹‰
            CATEGORY_MARKERS: ['Artist', 'Character', 'Copyright', 'Tag', 'Metadata', 'General'],
            
            // æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼
            PATTERNS: {
                GELBOORU_MARKERS: /(?:Artist|Character|Copyright|Tag|Metadata)\?/i,
                CATEGORY_CONTENT: /^(Artist|Character|Copyright|Metadata|Tag)\s+(.*)$/,
                WEIGHT_REMOVAL: /\s+\d+\.?\d*[kM]?\s*$/,
                GELBOORU_WEIGHT: /\s+\d+\s*(Artist|Character|Copyright|Metadata|Tag)?.*$/,
                NORMALIZE_SPACES: /\s+/g
            },
            
            // UIç›¸å…³é…ç½®
            UI: {
                COPY_SUCCESS_DURATION: 1500,
                COPY_SUCCESS_COLOR: '#34C759',
                DEFAULT_BUTTON_COLOR: '#007AFF'
            },
            
            // è¿‡æ»¤å™¨ç›¸å…³é…ç½®
            FILTER: {
                STORAGE_KEY: 'tagConverter_filterSettings',
                DEFAULT_ENABLED: false,
                DEFAULT_KEYWORDS: []
            }
        };

        // ====================================================================
        // è¿‡æ»¤å™¨ç®¡ç†æ¨¡å—
        // ====================================================================
        
        /**
         * FilterManager - è‡ªå®šä¹‰è¿‡æ»¤å™¨ç®¡ç†ç±»
         * 
         * åŠŸèƒ½è¯´æ˜ï¼š
         * - ç®¡ç†ç”¨æˆ·è‡ªå®šä¹‰çš„è¿‡æ»¤å…³é”®è¯åˆ—è¡¨
         * - æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼å’Œæ™®é€šå­—ç¬¦ä¸²åŒ¹é…
         * - æä¾›è¿‡æ»¤å™¨å¯ç”¨/ç¦ç”¨æ§åˆ¶
         * - æŒä¹…åŒ–å­˜å‚¨ç”¨æˆ·è®¾ç½®åˆ°localStorage
         * - å®æ—¶ç»Ÿè®¡è¿‡æ»¤æ•ˆæœ
         * 
         * ä½¿ç”¨åœºæ™¯ï¼š
         * - è¿‡æ»¤ä¸éœ€è¦çš„tagï¼ˆå¦‚watermarkã€nsfwç­‰ï¼‰
         * - ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤ç‰¹å®šæ¨¡å¼ï¼ˆå¦‚\d+pxï¼‰
         * - è¿‡æ»¤åŒ…å«ç©ºæ ¼çš„è¯ç»„ï¼ˆå¦‚bad qualityã€beautiful girlï¼‰
         * 
         * æŠ€æœ¯ç‰¹ç‚¹ï¼š
         * - æ™ºèƒ½æ­£åˆ™ç¼–è¯‘ï¼šè‡ªåŠ¨æ£€æµ‹å¹¶ç¼–è¯‘æ­£åˆ™è¡¨è¾¾å¼
         * - é”™è¯¯å®¹é”™ï¼šæ— æ•ˆæ­£åˆ™è‡ªåŠ¨è½¬ä¸ºæ™®é€šå­—ç¬¦ä¸²åŒ¹é…
         * - æ€§èƒ½ä¼˜åŒ–ï¼šé¢„ç¼–è¯‘æ¨¡å¼ï¼Œé¿å…é‡å¤è§£æ
         * - æ•°æ®æŒä¹…åŒ–ï¼šlocalStorageå­˜å‚¨ï¼Œåˆ·æ–°ä¿æŒè®¾ç½®
         */
        class FilterManager {
            constructor() {
                this.enabled = CONFIG.FILTER.DEFAULT_ENABLED;
                this.keywords = [...CONFIG.FILTER.DEFAULT_KEYWORDS];
                this.patterns = [];
                this.lastFilteredCount = 0;
                
                this.loadSettings();
                this.compilePatterns();
            }
            
            /**
             * åŠ è½½è¿‡æ»¤å™¨è®¾ç½®
             */
            loadSettings() {
                try {
                    const saved = localStorage.getItem(CONFIG.FILTER.STORAGE_KEY);
                    if (saved) {
                        const settings = JSON.parse(saved);
                        this.enabled = settings.enabled ?? CONFIG.FILTER.DEFAULT_ENABLED;
                        this.keywords = settings.keywords ?? [...CONFIG.FILTER.DEFAULT_KEYWORDS];
                        this.compilePatterns();
                    }
                } catch (error) {
                    console.warn('æ— æ³•åŠ è½½è¿‡æ»¤å™¨è®¾ç½®:', error);
                }
            }
            
            /**
             * ä¿å­˜è¿‡æ»¤å™¨è®¾ç½®
             */
            saveSettings() {
                try {
                    const settings = {
                        enabled: this.enabled,
                        keywords: this.keywords
                    };
                    localStorage.setItem(CONFIG.FILTER.STORAGE_KEY, JSON.stringify(settings));
                } catch (error) {
                    console.warn('æ— æ³•ä¿å­˜è¿‡æ»¤å™¨è®¾ç½®:', error);
                }
            }
            
            /**
             * ç¼–è¯‘æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼
             * 
             * å¤„ç†é€»è¾‘ï¼š
             * 1. æ¸…ç©ºç°æœ‰æ¨¡å¼æ•°ç»„
             * 2. éå†æ‰€æœ‰å…³é”®è¯
             * 3. å°è¯•ç¼–è¯‘ä¸ºæ­£åˆ™è¡¨è¾¾å¼
             * 4. ç¼–è¯‘å¤±è´¥åˆ™è½¬ä¸ºæ™®é€šå­—ç¬¦ä¸²åŒ¹é…ï¼ˆæ”¯æŒè¯è¾¹ç•Œï¼‰
             * 
             * ç‰¹æ®Šå¤„ç†ï¼š
             * - ç©ºå…³é”®è¯è‡ªåŠ¨è·³è¿‡
             * - å¤§å°å†™ä¸æ•æ„ŸåŒ¹é…ï¼ˆ'i'æ ‡å¿—ï¼‰
             * - æ™®é€šå­—ç¬¦ä¸²ä½¿ç”¨è¯è¾¹ç•ŒåŒ¹é…ï¼ˆ\bï¼‰
             * - ç‰¹æ®Šå­—ç¬¦è‡ªåŠ¨è½¬ä¹‰
             */
            compilePatterns() {
                this.patterns = [];
                this.keywords.forEach(keyword => {
                    if (!keyword.trim()) return;
                    
                    try {
                        // å°è¯•ä½œä¸ºæ­£åˆ™è¡¨è¾¾å¼ç¼–è¯‘
                        // ä½¿ç”¨'i'æ ‡å¿—å®ç°å¤§å°å†™ä¸æ•æ„ŸåŒ¹é…
                        const pattern = new RegExp(keyword.trim(), 'i');
                        this.patterns.push(pattern);
                    } catch (error) {
                        // æ­£åˆ™è¡¨è¾¾å¼ç¼–è¯‘å¤±è´¥ï¼Œå½“ä½œæ™®é€šå­—ç¬¦ä¸²å¤„ç†
                        // è½¬ä¹‰æ‰€æœ‰æ­£åˆ™ç‰¹æ®Šå­—ç¬¦ï¼Œé¿å…æ„å¤–åŒ¹é…
                        const escapedKeyword = keyword.trim().replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                        
                        // ä½¿ç”¨è¯è¾¹ç•Œ\bç¡®ä¿ç²¾ç¡®åŒ¹é…ï¼Œé¿å…è¯¯åŒ¹é…å­å­—ç¬¦ä¸²
                        // ä¾‹å¦‚ï¼šè¿‡æ»¤"girl"ä¸ä¼šè¯¯åŒ¹é…"girls"
                        this.patterns.push(new RegExp(`\\b${escapedKeyword}\\b`, 'i'));
                    }
                });
            }
            
            /**
             * è®¾ç½®å¯ç”¨çŠ¶æ€
             * @param {boolean} enabled - æ˜¯å¦å¯ç”¨
             */
            setEnabled(enabled) {
                this.enabled = Boolean(enabled);
                this.saveSettings();
            }
            
            /**
             * è®¾ç½®è¿‡æ»¤å…³é”®è¯
             * @param {string} keywordString - é€—å·åˆ†éš”çš„å…³é”®è¯å­—ç¬¦ä¸²
             */
            setKeywords(keywordString) {
                this.keywords = keywordString
                    .split(',')
                    .map(k => k.trim())
                    .filter(k => k.length > 0);
                
                this.compilePatterns();
                this.saveSettings();
            }
            
            /**
             * åº”ç”¨è¿‡æ»¤å™¨åˆ°tagåˆ—è¡¨
             * 
             * @param {string[]} tags - åŸå§‹tagåˆ—è¡¨
             * @returns {string[]} - è¿‡æ»¤åçš„tagåˆ—è¡¨
             * 
             * è¿‡æ»¤é€»è¾‘ï¼š
             * 1. æ£€æŸ¥è¿‡æ»¤å™¨æ˜¯å¦å¯ç”¨ä¸”æœ‰è¿‡æ»¤è§„åˆ™
             * 2. éå†æ¯ä¸ªtagï¼Œæµ‹è¯•æ˜¯å¦åŒ¹é…ä»»ä¸€è¿‡æ»¤è§„åˆ™
             * 3. ä¿ç•™ä¸åŒ¹é…ä»»ä½•è¿‡æ»¤è§„åˆ™çš„tag
             * 4. ç»Ÿè®¡è¢«è¿‡æ»¤çš„tagæ•°é‡
             * 
             * æ€§èƒ½è€ƒè™‘ï¼š
             * - æœªå¯ç”¨æ—¶ç›´æ¥è¿”å›ï¼Œé¿å…ä¸å¿…è¦çš„å¤„ç†
             * - ä½¿ç”¨Array.filterå’Œsomeæ–¹æ³•å®ç°é«˜æ•ˆè¿‡æ»¤
             * - ä¸€æ—¦åŒ¹é…åˆ°è§„åˆ™ç«‹å³åœæ­¢æ£€æŸ¥ï¼ˆçŸ­è·¯é€»è¾‘ï¼‰
             */
            applyFilter(tags) {
                // å¿«é€Ÿè·¯å¾„ï¼šè¿‡æ»¤å™¨æœªå¯ç”¨æˆ–æ— è¿‡æ»¤è§„åˆ™
                if (!this.enabled || this.patterns.length === 0) {
                    this.lastFilteredCount = 0;
                    return tags;
                }
                
                // åº”ç”¨è¿‡æ»¤è§„åˆ™
                const filtered = tags.filter(tag => {
                    // æ£€æŸ¥tagæ˜¯å¦åŒ¹é…ä»»ä¸€è¿‡æ»¤è§„åˆ™
                    // ä½¿ç”¨someæ–¹æ³•å®ç°çŸ­è·¯é€»è¾‘ï¼Œæé«˜æ€§èƒ½
                    return !this.patterns.some(pattern => pattern.test(tag));
                });
                
                // ç»Ÿè®¡è¢«è¿‡æ»¤æ‰çš„tagæ•°é‡ï¼Œç”¨äºUIæ˜¾ç¤º
                this.lastFilteredCount = tags.length - filtered.length;
                return filtered;
            }
            
            /**
             * è·å–è¿‡æ»¤å™¨çŠ¶æ€ä¿¡æ¯
             * @returns {Object} çŠ¶æ€ä¿¡æ¯
             */
            getStatus() {
                return {
                    enabled: this.enabled,
                    keywordCount: this.keywords.length,
                    lastFilteredCount: this.lastFilteredCount,
                    keywords: this.keywords
                };
            }
        }

        // ====================================================================
        // æ ¸å¿ƒå¤„ç†ç±»ï¼šTagè½¬æ¢å™¨
        // ====================================================================
        
        class TagConverter {
            constructor() {
                this.formatDetector = new FormatDetector();
                this.contentExtractor = new ContentExtractor();
                this.contentCleaner = new ContentCleaner();
                this.filterManager = new FilterManager();
                this.uiManager = new UIManager();
            }
            
            /**
             * ä¸»è½¬æ¢æ–¹æ³• - å››é˜¶æ®µå¤„ç†æµç¨‹çš„æ ¸å¿ƒå…¥å£
             * 
             * å¤„ç†æµç¨‹ï¼š
             * 1. æ ¼å¼æ£€æµ‹ï¼šè¯†åˆ«è¾“å…¥æ–‡æœ¬çš„æ ¼å¼ç±»å‹ï¼ˆDanbooru/Gelbooru/Standardï¼‰
             * 2. å†…å®¹æå–ï¼šæ ¹æ®æ ¼å¼ç±»å‹æå–åŸå§‹tagå†…å®¹
             * 3. å†…å®¹æ¸…ç†ï¼šæ ‡å‡†åŒ–å¤„ç†ã€å»é‡ã€ç§»é™¤æƒé‡ç­‰
             * 4. è‡ªå®šä¹‰è¿‡æ»¤ï¼šåº”ç”¨ç”¨æˆ·è®¾å®šçš„è¿‡æ»¤è§„åˆ™
             * 
             * @param {string} input - è¾“å…¥çš„åŸå§‹æ–‡æœ¬
             * @returns {string[]} - å¤„ç†åçš„tagæ•°ç»„
             * 
             * @throws {Error} å½“è½¬æ¢è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯æ—¶æŠ›å‡ºå¼‚å¸¸
             */
            convert(input) {
                if (!input || typeof input !== 'string') {
                    return [];
                }
                
                try {
                    // å››é˜¶æ®µå¤„ç†æµç¨‹
                    const format = this.formatDetector.detect(input.trim());
                    const rawContent = this.contentExtractor.extract(input.trim(), format);
                    const cleanedTags = this.contentCleaner.clean(rawContent);
                    const filteredTags = this.filterManager.applyFilter(cleanedTags);
                    
                    // æ›´æ–°UIçŠ¶æ€
                    this.uiManager.updateFormatStatus(format, filteredTags.length);
                    this.uiManager.updateFilterStatus(this.filterManager.getStatus());
                    
                    return filteredTags;
                } catch (error) {
                    console.error('è½¬æ¢è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:', error);
                    this.uiManager.showError('è½¬æ¢å¤±è´¥ï¼Œè¯·æ£€æŸ¥è¾“å…¥æ ¼å¼');
                    return [];
                }
            }
        }

        // ====================================================================
        // æ ¼å¼æ£€æµ‹æ¨¡å—
        // ====================================================================
        
        class FormatDetector {
            /**
             * æ£€æµ‹è¾“å…¥æ–‡æœ¬çš„æ ¼å¼ç±»å‹
             * @param {string} input - è¾“å…¥æ–‡æœ¬
             * @returns {string} - æ ¼å¼ç±»å‹ï¼ˆdanbooru/gelbooru/standardï¼‰
             */
            detect(input) {
                const hasNewlines = input.includes('\n');
                const hasGelbooruMarkers = CONFIG.PATTERNS.GELBOORU_MARKERS.test(input);
                const hasQuestionMarks = input.includes('?');
                
                // æ ¼å¼åˆ¤æ–­é€»è¾‘
                if (!hasNewlines && hasGelbooruMarkers) {
                    return CONFIG.FORMATS.GELBOORU;
                }
                
                if (hasNewlines && hasQuestionMarks) {
                    return CONFIG.FORMATS.DANBOORU;
                }
                
                if (!hasNewlines && hasQuestionMarks) {
                    return CONFIG.FORMATS.GELBOORU; // å•è¡Œå¸¦?çš„ä¹Ÿè¢«è§†ä¸ºGelbooru
                }
                
                return CONFIG.FORMATS.STANDARD; // é»˜è®¤ä¸ºæ ‡å‡†æ ¼å¼
            }
        }

        // ====================================================================
        // å†…å®¹æå–æ¨¡å—
        // ====================================================================
        
        class ContentExtractor {
            /**
             * æ ¹æ®æ ¼å¼ç±»å‹æå–åŸå§‹å†…å®¹
             * @param {string} input - è¾“å…¥æ–‡æœ¬
             * @param {string} format - æ ¼å¼ç±»å‹
             * @returns {string} - æå–çš„åŸå§‹å†…å®¹
             */
            extract(input, format) {
                switch (format) {
                    case CONFIG.FORMATS.DANBOORU:
                        return this.extractDanbooru(input);
                    case CONFIG.FORMATS.GELBOORU:
                        return this.extractGelbooru(input);
                    case CONFIG.FORMATS.STANDARD:
                    default:
                        return input; // æ ‡å‡†æ ¼å¼ç›´æ¥è¿”å›
                }
            }
            
            /**
             * æå–Danbooruæ ¼å¼å†…å®¹
             * @param {string} input - Danbooruæ ¼å¼è¾“å…¥
             * @returns {string} - æå–çš„å†…å®¹
             */
            extractDanbooru(input) {
                const lines = input.split('\n').map(line => line.trim());
                const contents = [];
                
                for (let i = 0; i < lines.length; i++) {
                    // æ‰¾åˆ°?æ ‡è®°è¡Œï¼Œæå–ä¸‹ä¸€è¡Œå†…å®¹
                    if (lines[i] === '?' && i + 1 < lines.length) {
                        contents.push(lines[i + 1]);
                        i++; // è·³è¿‡å·²å¤„ç†çš„ä¸‹ä¸€è¡Œ
                    }
                }
                
                return contents.join(', '); // ç”¨é€—å·è¿æ¥ä¿æŒç»“æ„
            }
            
            /**
             * æå–Gelbooruæ ¼å¼å†…å®¹
             * @param {string} input - Gelbooruæ ¼å¼è¾“å…¥
             * @returns {string} - æå–çš„å†…å®¹
             */
            extractGelbooru(input) {
                const segments = input.split('?');
                const processedSegments = [];
                
                for (const segment of segments) {
                    const trimmedSegment = segment.trim();
                    if (!trimmedSegment) continue;
                    
                    const processedContent = this.processGelbooruSegment(trimmedSegment);
                    if (processedContent) {
                        processedSegments.push(processedContent);
                    }
                }
                
                return processedSegments.join(', ');
            }
            
            /**
             * å¤„ç†å•ä¸ªGelbooruæ®µè½
             * @param {string} segment - å•ä¸ªæ®µè½
             * @returns {string|null} - å¤„ç†åçš„å†…å®¹æˆ–null
             */
            processGelbooruSegment(segment) {
                // æ£€æŸ¥æ˜¯å¦ä»¥åˆ†ç±»æ ‡è¯†ç¬¦å¼€å¤´
                const categoryMatch = segment.match(CONFIG.PATTERNS.CATEGORY_CONTENT);
                
                if (categoryMatch) {
                    // æå–åˆ†ç±»æ ‡è¯†ç¬¦åé¢çš„å†…å®¹
                    let content = categoryMatch[2];
                    // ç§»é™¤æœ«å°¾æ•°å­—å’Œå¯èƒ½çš„ä¸‹ä¸€ä¸ªåˆ†ç±»æ ‡è¯†ç¬¦
                    content = content.replace(CONFIG.PATTERNS.GELBOORU_WEIGHT, '').trim();
                    return content || null;
                } else {
                    // æ™®é€šå†…å®¹ï¼Œç§»é™¤æœ«å°¾æ•°å­—
                    const cleaned = segment.replace(/\s+\d+.*$/, '').trim();
                    return (cleaned && cleaned.length > 1) ? cleaned : null;
                }
            }
        }

        // ====================================================================
        // å†…å®¹æ¸…ç†æ¨¡å—
        // ====================================================================
        
        class ContentCleaner {
            /**
             * æ¸…ç†å’Œæ ‡å‡†åŒ–å†…å®¹
             * @param {string} rawText - åŸå§‹æ–‡æœ¬å†…å®¹
             * @returns {string[]} - æ¸…ç†åçš„tagæ•°ç»„
             */
            clean(rawText) {
                if (!rawText) return [];
                
                // æŒ‰é€—å·åˆ†å‰²å¹¶æ¸…ç†æ¯ä¸ªç‰‡æ®µ
                const segments = rawText.split(',').map(segment => segment.trim());
                const cleanedTags = [];
                
                for (const segment of segments) {
                    const cleanedTag = this.cleanSingleTag(segment);
                    if (cleanedTag) {
                        cleanedTags.push(cleanedTag);
                    }
                }
                
                return this.removeDuplicates(cleanedTags);
            }
            
            /**
             * æ¸…ç†å•ä¸ªtag
             * @param {string} tag - å•ä¸ªtag
             * @returns {string|null} - æ¸…ç†åçš„tagæˆ–null
             */
            cleanSingleTag(tag) {
                if (!tag) return null;
                
                // è·³è¿‡çº¯åˆ†ç±»æ ‡è¯†ç¬¦
                if (this.isPureCategoryWord(tag)) {
                    return null;
                }
                
                // ç§»é™¤æœ«å°¾çš„æ•°å­—æƒé‡
                let cleaned = tag.replace(CONFIG.PATTERNS.WEIGHT_REMOVAL, '').trim();
                
                // æ ‡å‡†åŒ–ç©ºæ ¼
                cleaned = cleaned.replace(CONFIG.PATTERNS.NORMALIZE_SPACES, ' ').trim();
                
                // éªŒè¯æœ‰æ•ˆæ€§
                return (cleaned && cleaned.length > 0) ? cleaned : null;
            }
            
            /**
             * æ£€æŸ¥æ˜¯å¦ä¸ºçº¯åˆ†ç±»æ ‡è¯†ç¬¦
             * @param {string} tag - å¾…æ£€æŸ¥çš„tag
             * @returns {boolean} - æ˜¯å¦ä¸ºåˆ†ç±»æ ‡è¯†ç¬¦
             */
            isPureCategoryWord(tag) {
                return CONFIG.CATEGORY_MARKERS.some(
                    word => word.toLowerCase() === tag.toLowerCase()
                );
            }
            
            /**
             * ç§»é™¤é‡å¤çš„tag
             * @param {string[]} tags - tagæ•°ç»„
             * @returns {string[]} - å»é‡åçš„tagæ•°ç»„
             */
            removeDuplicates(tags) {
                const seen = new Set();
                return tags.filter(tag => {
                    const lowerTag = tag.toLowerCase();
                    if (seen.has(lowerTag)) {
                        return false;
                    }
                    seen.add(lowerTag);
                    return true;
                });
            }
        }

        // ====================================================================
        // ç”¨æˆ·ç•Œé¢ç®¡ç†æ¨¡å—
        // ====================================================================
        
        class UIManager {
            constructor() {
                this.elements = {
                    input: document.getElementById('input'),
                    output: document.getElementById('output'),
                    formatStatus: document.getElementById('format-status'),
                    filterEnabled: document.getElementById('filter-enabled'),
                    filterKeywords: document.getElementById('filter-keywords'),
                    filterCount: document.getElementById('filter-count'),
                    filteredCount: document.getElementById('filtered-count'),
                    filterExpand: document.getElementById('filter-expand'),
                    filterContent: document.getElementById('filter-content')
                };
            }
            
            /**
             * æ›´æ–°æ ¼å¼çŠ¶æ€æ˜¾ç¤º
             * @param {string} format - æ£€æµ‹åˆ°çš„æ ¼å¼
             * @param {number} tagCount - tagæ•°é‡
             */
            updateFormatStatus(format, tagCount) {
                const statusEl = this.elements.formatStatus;
                if (!statusEl) return;
                
                const formatNames = {
                    [CONFIG.FORMATS.DANBOORU]: 'Danbooru',
                    [CONFIG.FORMATS.GELBOORU]: 'Gelbooru', 
                    [CONFIG.FORMATS.STANDARD]: 'Standard'
                };
                
                statusEl.textContent = `æ£€æµ‹æ ¼å¼: ${formatNames[format]}ï¼Œæå–Tags: ${tagCount}ä¸ª`;
                statusEl.className = 'status-indicator detected';
                statusEl.style.display = 'inline-block';
            }
            
            /**
             * æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
             * @param {string} message - é”™è¯¯ä¿¡æ¯
             */
            showError(message) {
                const outputEl = this.elements.output;
                if (outputEl) {
                    outputEl.textContent = `âš ï¸ ${message}`;
                    outputEl.className = '';
                }
            }
            
            /**
             * æ›´æ–°è¾“å‡ºå†…å®¹
             * @param {string[]} tags - tagæ•°ç»„
             */
            updateOutput(tags) {
                const outputEl = this.elements.output;
                if (!outputEl) return;
                
                if (tags.length === 0) {
                    outputEl.textContent = 'ç­‰å¾…è¾“å…¥å†…å®¹è¿›è¡Œè½¬æ¢...';
                    outputEl.className = '';
                } else {
                    outputEl.textContent = tags.join(', ');
                    outputEl.className = 'has-content';
                }
            }
            
            /**
             * æ˜¾ç¤ºå¤åˆ¶æˆåŠŸåé¦ˆ
             * @param {HTMLElement} button - å¤åˆ¶æŒ‰é’®å…ƒç´ 
             */
            showCopySuccess(button) {
                const originalText = button.textContent;
                const originalColor = button.style.background;
                
                button.textContent = 'âœ… å·²å¤åˆ¶';
                button.style.background = CONFIG.UI.COPY_SUCCESS_COLOR;
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = originalColor || CONFIG.UI.DEFAULT_BUTTON_COLOR;
                }, CONFIG.UI.COPY_SUCCESS_DURATION);
            }
            
            /**
             * æ›´æ–°è¿‡æ»¤å™¨çŠ¶æ€æ˜¾ç¤º
             * @param {Object} status - è¿‡æ»¤å™¨çŠ¶æ€
             */
            updateFilterStatus(status) {
                if (this.elements.filterCount) {
                    this.elements.filterCount.textContent = status.keywordCount;
                }
                if (this.elements.filteredCount) {
                    this.elements.filteredCount.textContent = status.lastFilteredCount;
                }
            }
            
            /**
             * åˆå§‹åŒ–è¿‡æ»¤å™¨UI
             * @param {FilterManager} filterManager - è¿‡æ»¤å™¨ç®¡ç†å™¨å®ä¾‹
             */
            initializeFilterUI(filterManager) {
                const status = filterManager.getStatus();
                
                if (this.elements.filterEnabled) {
                    this.elements.filterEnabled.checked = status.enabled;
                }
                
                if (this.elements.filterKeywords) {
                    this.elements.filterKeywords.value = status.keywords.join(', ');
                }
                
                this.updateFilterStatus(status);
            }
        }

        // ====================================================================
        // å…¨å±€å®ä¾‹å’Œä¸»è¦åŠŸèƒ½å‡½æ•°
        // ====================================================================
        
        // åˆ›å»ºå…¨å±€è½¬æ¢å™¨å®ä¾‹
        const tagConverter = new TagConverter();
        
        /**
         * ä¸»è½¬æ¢å‡½æ•° - ä¾›UIè°ƒç”¨çš„å…¥å£å‡½æ•°
         * 
         * åŠŸèƒ½è¯´æ˜ï¼š
         * - è·å–ç”¨æˆ·è¾“å…¥å¹¶è°ƒç”¨è½¬æ¢å™¨è¿›è¡Œå¤„ç†
         * - å¤„ç†ç©ºè¾“å…¥çŠ¶æ€ï¼Œè‡ªåŠ¨éšè—æ ¼å¼çŠ¶æ€æŒ‡ç¤ºå™¨
         * - æ›´æ–°è¾“å‡ºåŒºåŸŸæ˜¾ç¤ºè½¬æ¢ç»“æœ
         * - æä¾›å®æ—¶è½¬æ¢ä½“éªŒ
         * 
         * çŠ¶æ€ç®¡ç†ï¼š
         * - ç©ºè¾“å…¥æ—¶ï¼šéšè—æ ¼å¼çŠ¶æ€ï¼Œé‡ç½®è¾“å‡ºä¸ºé»˜è®¤æç¤º
         * - æœ‰æ•ˆè¾“å…¥æ—¶ï¼šæ˜¾ç¤ºæ£€æµ‹ç»“æœï¼Œæ›´æ–°è½¬æ¢è¾“å‡º
         */
        function convert() {
            const input = document.getElementById('input').value.trim();
            
            // æ£€æŸ¥è¾“å…¥æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºåˆ™éšè—æ ¼å¼çŠ¶æ€
            if (!input) {
                const statusEl = document.getElementById('format-status');
                if (statusEl) {
                    statusEl.style.display = 'none';
                }
                tagConverter.uiManager.updateOutput([]);
                return;
            }
            
            const tags = tagConverter.convert(input);
            tagConverter.uiManager.updateOutput(tags);
        }
        
        /**
         * å¤åˆ¶è¾“å‡ºç»“æœåˆ°å‰ªè´´æ¿
         * @param {HTMLElement} button - è§¦å‘çš„æŒ‰é’®å…ƒç´ 
         */
        function copyOutput(button) {
            const output = document.getElementById('output');
            const content = output.textContent.trim();
            
            if (!content || content === 'ç­‰å¾…è¾“å…¥å†…å®¹è¿›è¡Œè½¬æ¢...') {
                alert('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹');
                return;
            }
            
            navigator.clipboard.writeText(content)
                .then(() => {
                    tagConverter.uiManager.showCopySuccess(button);
                })
                .catch(err => {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                    alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¤åˆ¶');
                });
        }
        
        /**
         * ç¤ºä¾‹åŠ è½½ç®¡ç†å™¨ - ExampleManager
         * 
         * é—®é¢˜è§£å†³ï¼š
         * 1. é‡å¤ç‚¹å‡»é—®é¢˜ï¼šé€šè¿‡isLoadingæ ‡å¿—é˜²æ­¢å¿«é€Ÿè¿ç»­ç‚¹å‡»
         * 2. ç¤ºä¾‹é‡å¤é—®é¢˜ï¼šä½¿ç”¨å¾ªç¯é¡ºåºåŠ è½½ï¼Œé˜²æ­¢éšæœºå‡ºç°é‡å¤
         * 3. ç”¨æˆ·ä½“éªŒé—®é¢˜ï¼šæä¾›åŠ è½½çŠ¶æ€åé¦ˆå’ŒæŒ‰é’®ç¦ç”¨ä¿æŠ¤
         * 
         * æŠ€æœ¯ç‰¹ç‚¹ï¼š
         * - å¾ªç¯ç´¢å¼•ç®¡ç†ï¼šé˜²æ­¢è¶Šç•Œå’Œé‡å¤
         * - å¼‚æ­¥åŠ è½½æœºåˆ¶ï¼šä½¿ç”¨async/awaitæä¾›æµç•…ä½“éªŒ
         * - çŠ¶æ€ä¿æŠ¤ï¼šé€šè¿‡æ—¶é—´é”é˜²æ­¢å¹¶å‘æ“ä½œ
         * - UIåé¦ˆï¼šå®æ—¶æ›´æ–°æŒ‰é’®çŠ¶æ€å’Œæ–‡æœ¬
         */
        const ExampleManager = {
            examples: [
                // Danbooruæ ¼å¼ç¤ºä¾‹
                {
                    name: 'Danbooru',
                    content: `General\n?\n1boy 1.4M\n?\n1girl 6.1M\n?\noriginal 2.8M`
                },
                // Gelbooruæ ¼å¼ç¤ºä¾‹  
                {
                    name: 'Gelbooru',
                    content: `Artist? nekotokage 169Character? shirayuki tomoe 939Tag? 1girl 8032615? long hair 5441398? smile 3596391`
                },
                // æ ‡å‡†æ ¼å¼ç¤ºä¾‹
                {
                    name: 'Standard',
                    content: `masterpiece, best quality, 1girl, long hair, blue eyes, school uniform`
                }
            ],
            currentIndex: -1,
            isLoading: false,
            
            /**
             * è·å–ä¸‹ä¸€ä¸ªç¤ºä¾‹ï¼ˆå¾ªç¯é¡ºåºï¼Œé¿å…é‡å¤ï¼‰
             * 
             * ç®—æ³•è¯´æ˜ï¼š
             * - ä½¿ç”¨æ¨¡è¿ç®—å®ç°å¾ªç¯é€’å¢ç´¢å¼•
             * - ä»-1å¼€å§‹ï¼Œé¦–æ¬¡è°ƒç”¨æ—¶ç´¢å¼•å˜ä¸º0
             * - æ¯æ¬¡è°ƒç”¨éƒ½ä¿è¯è¿”å›ä¸åŒçš„ç¤ºä¾‹
             * - å¾ªç¯å®Œæˆåé‡æ–°ä»ç¬¬ä¸€ä¸ªå¼€å§‹
             * 
             * @returns {Object} åŒ…å«nameå’Œcontentçš„ç¤ºä¾‹å¯¹è±¡
             */
            getNextExample() {
                this.currentIndex = (this.currentIndex + 1) % this.examples.length;
                return this.examples[this.currentIndex];
            },
            
            /**
             * åŠ è½½ç¤ºä¾‹å¹¶é˜²æ­¢é‡å¤ç‚¹å‡»
             * 
             * æ‰§è¡Œæµç¨‹ï¼š
             * 1. æ£€æŸ¥æ˜¯å¦æ­£åœ¨åŠ è½½ï¼Œé˜²æ­¢å¹¶å‘è®¿é—®
             * 2. è®¾ç½®åŠ è½½çŠ¶æ€å’ŒæŒ‰é’®ç¦ç”¨
             * 3. è·å–ä¸‹ä¸€ä¸ªç¤ºä¾‹æ•°æ®å¹¶æ›´æ–°UI
             * 4. è°ƒç”¨è½¬æ¢å‡½æ•°å¤„ç†æ–°æ•°æ®
             * 5. æ°å¤æŒ‰é’®çŠ¶æ€å’Œè§£é™¤åŠ è½½é”
             * 
             * é˜²æŠ¤æœºåˆ¶ï¼š
             * - isLoadingæ ‡å¿—é˜²æ­¢å¹¶å‘è°ƒç”¨
             * - æŒ‰é’®ç¦ç”¨é˜²æ­¢ç”¨æˆ·é‡å¤ç‚¹å‡»
             * - try/finallyç¡®ä¿çŠ¶æ€æ¸…ç†
             * - å»¶æ—¶è§£é™¤é˜²æ­¢æ„å¤–å¿«é€Ÿç‚¹å‡»
             */
            async loadExample() {
                // é˜²é‡å¤ç‚¹å‡»
                if (this.isLoading) {
                    return;
                }
                
                this.isLoading = true;
                
                try {
                    const example = this.getNextExample();
                    const inputElement = document.getElementById('input');
                    const button = document.getElementById('load-example-btn');
                    
                    // æ›´æ–°æŒ‰é’®çŠ¶æ€
                    if (button) {
                        const originalText = button.textContent;
                        button.textContent = `â˜‘ï¸ å·²åŠ è½½`;
                        button.disabled = true;
                        
                        // æ¢å¤æŒ‰é’®çŠ¶æ€
                        setTimeout(() => {
                            button.textContent = originalText;
                            button.disabled = false;
                        }, 500);
                    }
                    
                    // åŠ è½½ç¤ºä¾‹å†…å®¹
                    inputElement.value = example.content;
                    convert();
                    
                    // æ˜¾ç¤ºåŠ è½½çš„ç¤ºä¾‹ç±»å‹
                    console.log(`å·²åŠ è½½ ${example.name} æ ¼å¼ç¤ºä¾‹`);
                    
                } finally {
                    // 500msåå…è®¸ä¸‹æ¬¡ç‚¹å‡»
                    setTimeout(() => {
                        this.isLoading = false;
                    }, 500);
                }
            }
        };
        
        /**
         * åŠ è½½ç¤ºä¾‹æ•°æ®ï¼ˆå…¨å±€å‡½æ•°ï¼Œä¾›æŒ‰é’®è°ƒç”¨ï¼‰
         */
        function loadExample() {
            ExampleManager.loadExample();
        }
        
        /**
         * æ¸…ç©ºæ‰€æœ‰å†…å®¹ - é‡ç½®åº”ç”¨çŠ¶æ€
         * 
         * æ¸…ç©ºæ“ä½œï¼š
         * 1. æ¸…ç©ºè¾“å…¥æ¡†å†…å®¹
         * 2. é‡ç½®è¾“å‡ºåŒºåŸŸä¸ºé»˜è®¤æç¤ºçŠ¶æ€
         * 3. éšè—æ ¼å¼æ£€æµ‹çŠ¶æ€æŒ‡ç¤ºå™¨
         * 4. æ¸…é™¤æ‰€æœ‰æ ·å¼ç±»
         * 
         * æ³¨æ„ï¼šä¸ä¼šæ¸…é™¤è¿‡æ»¤å™¨è®¾ç½®ï¼Œä¿æŒç”¨æˆ·é…ç½®
         */
        function clearAll() {
            document.getElementById('input').value = '';
            document.getElementById('output').textContent = 'ç­‰å¾…è¾“å…¥å†…å®¹è¿›è¡Œè½¬æ¢...';
            document.getElementById('output').className = '';
            
            const statusEl = document.getElementById('format-status');
            if (statusEl) {
                statusEl.style.display = 'none';
            }
        }
        
        /**
         * åˆ‡æ¢è¿‡æ»¤å™¨å¯ç”¨çŠ¶æ€
         * 
         * æ“ä½œæµç¨‹ï¼š
         * 1. è¯»å–ç”¨æˆ·åˆ‡æ¢çŠ¶æ€
         * 2. æ›´æ–°FilterManagerè®¾ç½®
         * 3. è‡ªåŠ¨ä¿å­˜åˆ°localStorage
         * 4. é‡æ–°è½¬æ¢å½“å‰å†…å®¹ä»¥åº”ç”¨æ–°è®¾ç½®
         * 
         * å®æ—¶æ›´æ–°ï¼šç¡®ä¿åˆ‡æ¢åç«‹å³çœ‹åˆ°æ•ˆæœ
         */
        function toggleFilter() {
            const enabled = document.getElementById('filter-enabled').checked;
            tagConverter.filterManager.setEnabled(enabled);
            
            // é‡æ–°è½¬æ¢å½“å‰å†…å®¹
            convert();
        }
        
        /**
         * æ›´æ–°è¿‡æ»¤å…³é”®è¯
         * 
         * å¤„ç†æµç¨‹ï¼š
         * 1. è·å–ç”¨æˆ·è¾“å…¥çš„å…³é”®è¯å­—ç¬¦ä¸²
         * 2. è§£æä¸ºå…³é”®è¯æ•°ç»„ï¼ˆé€—å·åˆ†å‰²ï¼‰
         * 3. æ›´æ–°FilterManagerçš„å…³é”®è¯åˆ—è¡¨
         * 4. é‡æ–°ç¼–è¯‘æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼
         * 5. ä¿å­˜è®¾ç½®åˆ°localStorage
         * 6. æ›´æ–°UIç»Ÿè®¡ä¿¡æ¯
         * 7. é‡æ–°è½¬æ¢å½“å‰å†…å®¹
         * 
         * æ”¯æŒæ ¼å¼ï¼š
         * - é€—å·åˆ†å‰²çš„æ™®é€šå…³é”®è¯
         * - æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼
         * - åŒ…å«ç©ºæ ¼çš„è¯ç»„
         */
        function updateFilterKeywords() {
            const keywords = document.getElementById('filter-keywords').value;
            tagConverter.filterManager.setKeywords(keywords);
            
            // æ›´æ–°UIçŠ¶æ€
            tagConverter.uiManager.updateFilterStatus(tagConverter.filterManager.getStatus());
            
            // é‡æ–°è½¬æ¢å½“å‰å†…å®¹
            convert();
        }
        
        /**
         * åˆ‡æ¢è¿‡æ»¤å™¨è®¾ç½®åŒºåŸŸæ˜¾ç¤º/éšè—
         * 
         * åŠŸèƒ½è¯´æ˜ï¼š
         * - æ§åˆ¶è¿‡æ»¤å™¨é…ç½®åŒºåŸŸçš„å±•å¼€/æŠ˜å çŠ¶æ€
         * - æä¾›ç´§å‡‘çš„UIå¸ƒå±€ï¼Œé»˜è®¤æŠ˜å èŠ‚çœç©ºé—´
         * - å®æ—¶æ›´æ–°æŒ‰é’®æ–‡æœ¬åæ˜ å½“å‰çŠ¶æ€
         * 
         * äº¤äº’é€»è¾‘ï¼š
         * - æŠ˜å çŠ¶æ€ï¼šæ˜¾ç¤º"å±•å¼€è®¾ç½®"
         * - å±•å¼€çŠ¶æ€ï¼šæ˜¾ç¤º"æ”¶èµ·è®¾ç½®"
         */
        function toggleFilterSection() {
            const content = document.getElementById('filter-content');
            const button = document.getElementById('filter-expand');
            
            if (content.style.display === 'none' || content.style.display === '') {
                content.style.display = 'block';
                button.textContent = 'æ”¶èµ·è®¾ç½®';
            } else {
                content.style.display = 'none';
                button.textContent = 'å±•å¼€è®¾ç½®';
            }
        }

        // ====================================================================
        // äº‹ä»¶ç›‘å¬å™¨å’Œåˆå§‹åŒ–
        // ====================================================================
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–è¿‡æ»¤å™¨UI
            tagConverter.uiManager.initializeFilterUI(tagConverter.filterManager);
            
            // å®æ—¶è½¬æ¢ç›‘å¬
            document.getElementById('input').addEventListener('input', convert);
            
            // ç§»é™¤é”®ç›˜å¿«æ·é”®ä»¥é¿å…å†²çª
            
            console.log('Tagæ ¼å¼è½¬æ¢å™¨å·²åˆå§‹åŒ– - æ”¯æŒDanbooru/Gelbooru/Standardæ ¼å¼ + è‡ªå®šä¹‰è¿‡æ»¤');
        });
    </script>
</body>
</html>