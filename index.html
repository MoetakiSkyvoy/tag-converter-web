<!-- index.html -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tagæ ¼å¼è½¬æ¢å™¨ - æ”¯æŒDanbooru/Gelbooruå¤šæ ¼å¼è½¬æ¢</title>
    <meta name="description" content="æ™ºèƒ½Tagæ ¼å¼è½¬æ¢å™¨ï¼Œæ”¯æŒDanbooruå’ŒGelbooruæ ¼å¼è‡ªåŠ¨è¯†åˆ«å’Œè½¬æ¢ï¼Œå®æ—¶å¤„ç†ï¼Œä¸€é”®å¤åˆ¶">
    <meta name="keywords" content="Tagè½¬æ¢å™¨,Danbooru,Gelbooru,æç¤ºè¯,AIç»˜å›¾">
    
    <style>
        /* =================================
           åŸºç¡€æ ·å¼ä¸å¸ƒå±€
           ================================= */
        
        /* å…¨å±€å­—ä½“å’Œå¸ƒå±€è®¾ç½® */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            max-width: 900px;
            margin: 2rem auto;
            padding: 0 1rem;
            line-height: 1.6;
            color: #333;
            background-color: #fafafa;
        }
        
        /* ä¸»å®¹å™¨æ ·å¼ */
        .container {
            background: #ffffff;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.3s ease;
        }
        
        .container:hover {
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
        }
        
        /* æ ‡é¢˜æ ·å¼ */
        h1 {
            text-align: center;
            color: #1d1d1f;
            font-weight: 700;
            margin-bottom: 0.5rem;
            font-size: 2.2rem;
        }
        
        .subtitle {
            text-align: center;
            color: #86868b;
            font-size: 1rem;
            margin-bottom: 2rem;
        }
        
        /* =================================
           è¾“å…¥è¾“å‡ºåŒºåŸŸæ ·å¼
           ================================= */
        
        /* è¾“å…¥æ–‡æœ¬æ¡†æ ·å¼ */
        .input-section {
            margin-bottom: 1.5rem;
        }
        
        .input-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #1d1d1f;
        }
        
        textarea {
            width: 100%;
            height: 300px;
            padding: 16px;
            border: 2px solid #e5e5e7;
            border-radius: 12px;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;
            font-size: 14px;
            line-height: 1.5;
            resize: vertical;
            transition: border-color 0.2s ease;
            box-sizing: border-box;
        }
        
        textarea:focus {
            outline: none;
            border-color: #007AFF;
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }
        
        /* æŒ‰é’®ç»„æ ·å¼ */
        .button-group {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        button {
            background: #007AFF;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
            min-width: 120px;
        }
        
        button:hover {
            background: #0056CC;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button.secondary {
            background: #f2f2f7;
            color: #1d1d1f;
        }
        
        button.secondary:hover {
            background: #e5e5ea;
        }
        
        /* è¾“å‡ºåŒºåŸŸæ ·å¼ */
        .output-section {
            margin-top: 1.5rem;
        }
        
        .output-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #1d1d1f;
        }
        
        #output {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 16px;
            min-height: 100px;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: #495057;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        #output.has-content {
            background: #e8f5e8;
            border-color: #28a745;
            color: #155724;
            text-align: left;
            justify-content: flex-start;
        }
        
        /* çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .status-indicator {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .status-indicator.detected {
            background: #e3f2fd;
            color: #1976d2;
        }
        
        /* =================================
           å“åº”å¼è®¾è®¡
           ================================= */
        
        @media (max-width: 768px) {
            body {
                margin: 1rem auto;
                padding: 0 0.5rem;
            }
            
            .container {
                padding: 1.5rem;
                border-radius: 12px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            textarea {
                height: 250px;
                padding: 12px;
            }
            
            .button-group {
                flex-direction: column;
                align-items: center;
            }
            
            button {
                width: 100%;
                max-width: 200px;
            }
        }
        
        /* =================================
           å·¥å…·æç¤ºå’ŒåŠ¨ç”»
           ================================= */
        
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }
        
        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid #ccc;
            border-top: 2px solid #007AFF;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡µé¢æ ‡é¢˜åŒºåŸŸ -->
        <header>
            <h1>Tagæ ¼å¼è½¬æ¢å™¨</h1>
            <p class="subtitle">æ”¯æŒDanbooruã€Gelbooruå¤šæ ¼å¼æ™ºèƒ½è½¬æ¢ã€å®æ—¶å¤„ç†å’Œä¸€é”®å¤åˆ¶</p>
        </header>
        
        <!-- è¾“å…¥åŒºåŸŸ -->
        <section class="input-section">
            <label for="input" class="input-label">è¾“å…¥åŸå§‹Tagæ–‡æœ¬</label>
            <textarea 
                id="input" 
                placeholder="è¯·ç²˜è´´æ¥è‡ªDanbooruæˆ–Gelbooruçš„åŸå§‹tagæ–‡æœ¬...&#10;&#10;æ”¯æŒæ ¼å¼ï¼š&#10;â€¢ Danbooru: æ¢è¡Œç¬¦+?æ ‡è®°æ ¼å¼&#10;â€¢ Gelbooru: Artist?/Tag?è¿ç»­æ ¼å¼&#10;â€¢ Standard: é€—å·åˆ†éš”æ ‡å‡†æ ¼å¼"
                aria-describedby="input-help"></textarea>
            <div id="format-status" class="status-indicator" style="display: none;"></div>
        </section>
        
        <!-- æ“ä½œæŒ‰é’®ç»„ -->
        <section class="button-group">
            <button 
                onclick="loadExample()" 
                class="secondary tooltip" 
                data-tooltip="åŠ è½½Danbooruæ ¼å¼ç¤ºä¾‹æ•°æ®">
                ğŸ“ åŠ è½½ç¤ºä¾‹
            </button>
            <button 
                onclick="clearAll()" 
                class="secondary tooltip" 
                data-tooltip="æ¸…ç©ºè¾“å…¥å’Œè¾“å‡ºå†…å®¹">
                ğŸ—‘ï¸ æ¸…ç©ºå†…å®¹
            </button>
            <button 
                onclick="copyOutput(this)" 
                class="tooltip" 
                data-tooltip="å¤åˆ¶è½¬æ¢ç»“æœåˆ°å‰ªè´´æ¿">
                ğŸ“‹ å¤åˆ¶ç»“æœ
            </button>
        </section>
        
        <!-- è¾“å‡ºåŒºåŸŸ -->
        <section class="output-section">
            <label for="output" class="output-label">è½¬æ¢ç»“æœ</label>
            <div 
                id="output" 
                aria-live="polite" 
                aria-label="è½¬æ¢ç»“æœè¾“å‡ºåŒºåŸŸ">ç­‰å¾…è¾“å…¥å†…å®¹è¿›è¡Œè½¬æ¢...
            </div>
        </section>
    </div>

    <script>
        /**
         * ====================================================================
         * Tagæ ¼å¼è½¬æ¢å™¨ - ç»Ÿä¸€å¤„ç†ç®—æ³•
         * ====================================================================
         * 
         * åŠŸèƒ½æ¦‚è¿°ï¼š
         * - æ”¯æŒDanbooruã€Gelbooruã€Standardä¸‰ç§æ ¼å¼çš„æ™ºèƒ½è¯†åˆ«å’Œè½¬æ¢
         * - é‡‡ç”¨ä¸‰é˜¶æ®µå¤„ç†æµç¨‹ï¼šæ ¼å¼æ£€æµ‹ â†’ å†…å®¹æå– â†’ ç»Ÿä¸€æ¸…ç†
         * - ä¿æŠ¤è¯ç»„å®Œæ•´æ€§ï¼Œé˜²æ­¢å¤åˆè¯ç»„è¢«é”™è¯¯åˆ†å‰²
         * - å®æ—¶è½¬æ¢ï¼Œç”¨æˆ·ä½“éªŒå‹å¥½
         * 
         * æ¶æ„è®¾è®¡ï¼š
         * - TagConverter: ä¸»æ§åˆ¶å™¨ç±»
         * - FormatDetector: æ ¼å¼æ£€æµ‹æ¨¡å—
         * - ContentExtractor: å†…å®¹æå–æ¨¡å—  
         * - ContentCleaner: å†…å®¹æ¸…ç†æ¨¡å—
         * - UIManager: ç”¨æˆ·ç•Œé¢ç®¡ç†æ¨¡å—
         */

        // ====================================================================
        // å¸¸é‡å®šä¹‰å’Œé…ç½®
        // ====================================================================
        
        const CONFIG = {
            // æ”¯æŒçš„æ ¼å¼ç±»å‹
            FORMATS: {
                DANBOORU: 'danbooru',    // Danbooruæ ¼å¼ï¼šæ¢è¡Œç¬¦+?æ ‡è®°
                GELBOORU: 'gelbooru',    // Gelbooruæ ¼å¼ï¼šArtist?/Tag?è¿ç»­æ ¼å¼  
                STANDARD: 'standard'     // æ ‡å‡†æ ¼å¼ï¼šé€—å·åˆ†éš”
            },
            
            // åˆ†ç±»æ ‡è¯†ç¬¦å®šä¹‰
            CATEGORY_MARKERS: ['Artist', 'Character', 'Copyright', 'Tag', 'Metadata', 'General'],
            
            // æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼
            PATTERNS: {
                GELBOORU_MARKERS: /(?:Artist|Character|Copyright|Tag|Metadata)\?/i,
                CATEGORY_CONTENT: /^(Artist|Character|Copyright|Metadata|Tag)\s+(.*)$/,
                WEIGHT_REMOVAL: /\s+\d+\.?\d*[kM]?\s*$/,
                GELBOORU_WEIGHT: /\s+\d+\s*(Artist|Character|Copyright|Metadata|Tag)?.*$/,
                NORMALIZE_SPACES: /\s+/g
            },
            
            // UIç›¸å…³é…ç½®
            UI: {
                COPY_SUCCESS_DURATION: 1500,
                COPY_SUCCESS_COLOR: '#34C759',
                DEFAULT_BUTTON_COLOR: '#007AFF'
            }
        };

        // ====================================================================
        // æ ¸å¿ƒå¤„ç†ç±»ï¼šTagè½¬æ¢å™¨
        // ====================================================================
        
        class TagConverter {
            constructor() {
                this.formatDetector = new FormatDetector();
                this.contentExtractor = new ContentExtractor();
                this.contentCleaner = new ContentCleaner();
                this.uiManager = new UIManager();
            }
            
            /**
             * ä¸»è½¬æ¢æ–¹æ³•
             * @param {string} input - è¾“å…¥çš„åŸå§‹æ–‡æœ¬
             * @returns {string[]} - å¤„ç†åçš„tagæ•°ç»„
             */
            convert(input) {
                if (!input || typeof input !== 'string') {
                    return [];
                }
                
                try {
                    // ä¸‰é˜¶æ®µå¤„ç†æµç¨‹
                    const format = this.formatDetector.detect(input.trim());
                    const rawContent = this.contentExtractor.extract(input.trim(), format);
                    const cleanedTags = this.contentCleaner.clean(rawContent);
                    
                    // æ›´æ–°UIçŠ¶æ€
                    this.uiManager.updateFormatStatus(format, cleanedTags.length);
                    
                    return cleanedTags;
                } catch (error) {
                    console.error('è½¬æ¢è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:', error);
                    this.uiManager.showError('è½¬æ¢å¤±è´¥ï¼Œè¯·æ£€æŸ¥è¾“å…¥æ ¼å¼');
                    return [];
                }
            }
        }

        // ====================================================================
        // æ ¼å¼æ£€æµ‹æ¨¡å—
        // ====================================================================
        
        class FormatDetector {
            /**
             * æ£€æµ‹è¾“å…¥æ–‡æœ¬çš„æ ¼å¼ç±»å‹
             * @param {string} input - è¾“å…¥æ–‡æœ¬
             * @returns {string} - æ ¼å¼ç±»å‹ï¼ˆdanbooru/gelbooru/standardï¼‰
             */
            detect(input) {
                const hasNewlines = input.includes('\n');
                const hasGelbooruMarkers = CONFIG.PATTERNS.GELBOORU_MARKERS.test(input);
                const hasQuestionMarks = input.includes('?');
                
                // æ ¼å¼åˆ¤æ–­é€»è¾‘
                if (!hasNewlines && hasGelbooruMarkers) {
                    return CONFIG.FORMATS.GELBOORU;
                }
                
                if (hasNewlines && hasQuestionMarks) {
                    return CONFIG.FORMATS.DANBOORU;
                }
                
                if (!hasNewlines && hasQuestionMarks) {
                    return CONFIG.FORMATS.GELBOORU; // å•è¡Œå¸¦?çš„ä¹Ÿè¢«è§†ä¸ºGelbooru
                }
                
                return CONFIG.FORMATS.STANDARD; // é»˜è®¤ä¸ºæ ‡å‡†æ ¼å¼
            }
        }

        // ====================================================================
        // å†…å®¹æå–æ¨¡å—
        // ====================================================================
        
        class ContentExtractor {
            /**
             * æ ¹æ®æ ¼å¼ç±»å‹æå–åŸå§‹å†…å®¹
             * @param {string} input - è¾“å…¥æ–‡æœ¬
             * @param {string} format - æ ¼å¼ç±»å‹
             * @returns {string} - æå–çš„åŸå§‹å†…å®¹
             */
            extract(input, format) {
                switch (format) {
                    case CONFIG.FORMATS.DANBOORU:
                        return this.extractDanbooru(input);
                    case CONFIG.FORMATS.GELBOORU:
                        return this.extractGelbooru(input);
                    case CONFIG.FORMATS.STANDARD:
                    default:
                        return input; // æ ‡å‡†æ ¼å¼ç›´æ¥è¿”å›
                }
            }
            
            /**
             * æå–Danbooruæ ¼å¼å†…å®¹
             * @param {string} input - Danbooruæ ¼å¼è¾“å…¥
             * @returns {string} - æå–çš„å†…å®¹
             */
            extractDanbooru(input) {
                const lines = input.split('\n').map(line => line.trim());
                const contents = [];
                
                for (let i = 0; i < lines.length; i++) {
                    // æ‰¾åˆ°?æ ‡è®°è¡Œï¼Œæå–ä¸‹ä¸€è¡Œå†…å®¹
                    if (lines[i] === '?' && i + 1 < lines.length) {
                        contents.push(lines[i + 1]);
                        i++; // è·³è¿‡å·²å¤„ç†çš„ä¸‹ä¸€è¡Œ
                    }
                }
                
                return contents.join(', '); // ç”¨é€—å·è¿æ¥ä¿æŒç»“æ„
            }
            
            /**
             * æå–Gelbooruæ ¼å¼å†…å®¹
             * @param {string} input - Gelbooruæ ¼å¼è¾“å…¥
             * @returns {string} - æå–çš„å†…å®¹
             */
            extractGelbooru(input) {
                const segments = input.split('?');
                const processedSegments = [];
                
                for (const segment of segments) {
                    const trimmedSegment = segment.trim();
                    if (!trimmedSegment) continue;
                    
                    const processedContent = this.processGelbooruSegment(trimmedSegment);
                    if (processedContent) {
                        processedSegments.push(processedContent);
                    }
                }
                
                return processedSegments.join(', ');
            }
            
            /**
             * å¤„ç†å•ä¸ªGelbooruæ®µè½
             * @param {string} segment - å•ä¸ªæ®µè½
             * @returns {string|null} - å¤„ç†åçš„å†…å®¹æˆ–null
             */
            processGelbooruSegment(segment) {
                // æ£€æŸ¥æ˜¯å¦ä»¥åˆ†ç±»æ ‡è¯†ç¬¦å¼€å¤´
                const categoryMatch = segment.match(CONFIG.PATTERNS.CATEGORY_CONTENT);
                
                if (categoryMatch) {
                    // æå–åˆ†ç±»æ ‡è¯†ç¬¦åé¢çš„å†…å®¹
                    let content = categoryMatch[2];
                    // ç§»é™¤æœ«å°¾æ•°å­—å’Œå¯èƒ½çš„ä¸‹ä¸€ä¸ªåˆ†ç±»æ ‡è¯†ç¬¦
                    content = content.replace(CONFIG.PATTERNS.GELBOORU_WEIGHT, '').trim();
                    return content || null;
                } else {
                    // æ™®é€šå†…å®¹ï¼Œç§»é™¤æœ«å°¾æ•°å­—
                    const cleaned = segment.replace(/\s+\d+.*$/, '').trim();
                    return (cleaned && cleaned.length > 1) ? cleaned : null;
                }
            }
        }

        // ====================================================================
        // å†…å®¹æ¸…ç†æ¨¡å—
        // ====================================================================
        
        class ContentCleaner {
            /**
             * æ¸…ç†å’Œæ ‡å‡†åŒ–å†…å®¹
             * @param {string} rawText - åŸå§‹æ–‡æœ¬å†…å®¹
             * @returns {string[]} - æ¸…ç†åçš„tagæ•°ç»„
             */
            clean(rawText) {
                if (!rawText) return [];
                
                // æŒ‰é€—å·åˆ†å‰²å¹¶æ¸…ç†æ¯ä¸ªç‰‡æ®µ
                const segments = rawText.split(',').map(segment => segment.trim());
                const cleanedTags = [];
                
                for (const segment of segments) {
                    const cleanedTag = this.cleanSingleTag(segment);
                    if (cleanedTag) {
                        cleanedTags.push(cleanedTag);
                    }
                }
                
                return this.removeDuplicates(cleanedTags);
            }
            
            /**
             * æ¸…ç†å•ä¸ªtag
             * @param {string} tag - å•ä¸ªtag
             * @returns {string|null} - æ¸…ç†åçš„tagæˆ–null
             */
            cleanSingleTag(tag) {
                if (!tag) return null;
                
                // è·³è¿‡çº¯åˆ†ç±»æ ‡è¯†ç¬¦
                if (this.isPureCategoryWord(tag)) {
                    return null;
                }
                
                // ç§»é™¤æœ«å°¾çš„æ•°å­—æƒé‡
                let cleaned = tag.replace(CONFIG.PATTERNS.WEIGHT_REMOVAL, '').trim();
                
                // æ ‡å‡†åŒ–ç©ºæ ¼
                cleaned = cleaned.replace(CONFIG.PATTERNS.NORMALIZE_SPACES, ' ').trim();
                
                // éªŒè¯æœ‰æ•ˆæ€§
                return (cleaned && cleaned.length > 0) ? cleaned : null;
            }
            
            /**
             * æ£€æŸ¥æ˜¯å¦ä¸ºçº¯åˆ†ç±»æ ‡è¯†ç¬¦
             * @param {string} tag - å¾…æ£€æŸ¥çš„tag
             * @returns {boolean} - æ˜¯å¦ä¸ºåˆ†ç±»æ ‡è¯†ç¬¦
             */
            isPureCategoryWord(tag) {
                return CONFIG.CATEGORY_MARKERS.some(
                    word => word.toLowerCase() === tag.toLowerCase()
                );
            }
            
            /**
             * ç§»é™¤é‡å¤çš„tag
             * @param {string[]} tags - tagæ•°ç»„
             * @returns {string[]} - å»é‡åçš„tagæ•°ç»„
             */
            removeDuplicates(tags) {
                const seen = new Set();
                return tags.filter(tag => {
                    const lowerTag = tag.toLowerCase();
                    if (seen.has(lowerTag)) {
                        return false;
                    }
                    seen.add(lowerTag);
                    return true;
                });
            }
        }

        // ====================================================================
        // ç”¨æˆ·ç•Œé¢ç®¡ç†æ¨¡å—
        // ====================================================================
        
        class UIManager {
            constructor() {
                this.elements = {
                    input: document.getElementById('input'),
                    output: document.getElementById('output'),
                    formatStatus: document.getElementById('format-status')
                };
            }
            
            /**
             * æ›´æ–°æ ¼å¼çŠ¶æ€æ˜¾ç¤º
             * @param {string} format - æ£€æµ‹åˆ°çš„æ ¼å¼
             * @param {number} tagCount - tagæ•°é‡
             */
            updateFormatStatus(format, tagCount) {
                const statusEl = this.elements.formatStatus;
                if (!statusEl) return;
                
                const formatNames = {
                    [CONFIG.FORMATS.DANBOORU]: 'Danbooru',
                    [CONFIG.FORMATS.GELBOORU]: 'Gelbooru', 
                    [CONFIG.FORMATS.STANDARD]: 'Standard'
                };
                
                statusEl.textContent = `æ£€æµ‹æ ¼å¼: ${formatNames[format]}ï¼Œæå–Tags: ${tagCount}ä¸ª`;
                statusEl.className = 'status-indicator detected';
                statusEl.style.display = 'inline-block';
            }
            
            /**
             * æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
             * @param {string} message - é”™è¯¯ä¿¡æ¯
             */
            showError(message) {
                const outputEl = this.elements.output;
                if (outputEl) {
                    outputEl.textContent = `âš ï¸ ${message}`;
                    outputEl.className = '';
                }
            }
            
            /**
             * æ›´æ–°è¾“å‡ºå†…å®¹
             * @param {string[]} tags - tagæ•°ç»„
             */
            updateOutput(tags) {
                const outputEl = this.elements.output;
                if (!outputEl) return;
                
                if (tags.length === 0) {
                    outputEl.textContent = 'ç­‰å¾…è¾“å…¥å†…å®¹è¿›è¡Œè½¬æ¢...';
                    outputEl.className = '';
                } else {
                    outputEl.textContent = tags.join(', ');
                    outputEl.className = 'has-content';
                }
            }
            
            /**
             * æ˜¾ç¤ºå¤åˆ¶æˆåŠŸåé¦ˆ
             * @param {HTMLElement} button - å¤åˆ¶æŒ‰é’®å…ƒç´ 
             */
            showCopySuccess(button) {
                const originalText = button.textContent;
                const originalColor = button.style.background;
                
                button.textContent = 'âœ… å·²å¤åˆ¶';
                button.style.background = CONFIG.UI.COPY_SUCCESS_COLOR;
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = originalColor || CONFIG.UI.DEFAULT_BUTTON_COLOR;
                }, CONFIG.UI.COPY_SUCCESS_DURATION);
            }
        }

        // ====================================================================
        // å…¨å±€å®ä¾‹å’Œä¸»è¦åŠŸèƒ½å‡½æ•°
        // ====================================================================
        
        // åˆ›å»ºå…¨å±€è½¬æ¢å™¨å®ä¾‹
        const tagConverter = new TagConverter();
        
        /**
         * ä¸»è½¬æ¢å‡½æ•° - ä¾›UIè°ƒç”¨
         */
        function convert() {
            const input = document.getElementById('input').value.trim();
            const tags = tagConverter.convert(input);
            tagConverter.uiManager.updateOutput(tags);
        }
        
        /**
         * å¤åˆ¶è¾“å‡ºç»“æœåˆ°å‰ªè´´æ¿
         * @param {HTMLElement} button - è§¦å‘çš„æŒ‰é’®å…ƒç´ 
         */
        function copyOutput(button) {
            const output = document.getElementById('output');
            const content = output.textContent.trim();
            
            if (!content || content === 'ç­‰å¾…è¾“å…¥å†…å®¹è¿›è¡Œè½¬æ¢...') {
                alert('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹');
                return;
            }
            
            navigator.clipboard.writeText(content)
                .then(() => {
                    tagConverter.uiManager.showCopySuccess(button);
                })
                .catch(err => {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                    alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¤åˆ¶');
                });
        }
        
        /**
         * åŠ è½½ç¤ºä¾‹æ•°æ®
         */
        function loadExample() {
            const examples = [
                // Danbooruæ ¼å¼ç¤ºä¾‹
                `General\n?\n1boy 1.4M\n?\n1girl 6.1M\n?\noriginal 2.8M`,
                // Gelbooruæ ¼å¼ç¤ºä¾‹  
                `Artist? nekotokage 169Character? shirayuki tomoe 939Tag? 1girl 8032615? long hair 5441398? smile 3596391`,
                // æ ‡å‡†æ ¼å¼ç¤ºä¾‹
                `masterpiece, best quality, 1girl, long hair, blue eyes, school uniform`
            ];
            
            const randomExample = examples[Math.floor(Math.random() * examples.length)];
            document.getElementById('input').value = randomExample;
            convert();
        }
        
        /**
         * æ¸…ç©ºæ‰€æœ‰å†…å®¹
         */
        function clearAll() {
            document.getElementById('input').value = '';
            document.getElementById('output').textContent = 'ç­‰å¾…è¾“å…¥å†…å®¹è¿›è¡Œè½¬æ¢...';
            document.getElementById('output').className = '';
            
            const statusEl = document.getElementById('format-status');
            if (statusEl) {
                statusEl.style.display = 'none';
            }
        }

        // ====================================================================
        // äº‹ä»¶ç›‘å¬å™¨å’Œåˆå§‹åŒ–
        // ====================================================================
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // å®æ—¶è½¬æ¢ç›‘å¬
            document.getElementById('input').addEventListener('input', convert);
            
            // é”®ç›˜å¿«æ·é”®æ”¯æŒ
            document.addEventListener('keydown', function(e) {
                // Ctrl+Enter æˆ– Cmd+Enter å¤åˆ¶ç»“æœ
                if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                    e.preventDefault();
                    const copyBtn = document.querySelector('button[onclick*="copyOutput"]');
                    if (copyBtn) copyOutput(copyBtn);
                }
                
                // Ctrl+L æˆ– Cmd+L åŠ è½½ç¤ºä¾‹
                if ((e.ctrlKey || e.metaKey) && e.key === 'l') {
                    e.preventDefault();
                    loadExample();
                }
            });
            
            console.log('Tagæ ¼å¼è½¬æ¢å™¨å·²åˆå§‹åŒ– - æ”¯æŒDanbooru/Gelbooru/Standardæ ¼å¼');
        });
    </script>
</body>
</html>