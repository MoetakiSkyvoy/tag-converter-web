<!-- index.html -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tag格式转换器 - 支持Danbooru/Gelbooru多格式转换</title>
    <meta name="description" content="智能Tag格式转换器，支持Danbooru和Gelbooru格式自动识别和转换，实时处理，一键复制">
    <meta name="keywords" content="Tag转换器,Danbooru,Gelbooru,提示词,AI绘图">
    
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
    <div class="container">
        <!-- 页面标题区域 -->
        <header>
            <h1>Tag格式转换器</h1>
        </header>
        
        <!-- 输入区域 -->
        <section class="input-section">
            <label for="input" class="input-label">输入原始Tag文本</label>
            <textarea 
                id="input" 
                placeholder="请粘贴来自Danbooru或Gelbooru的原始tag文本...&#10;&#10;支持格式：&#10;• Danbooru: 换行符+?标记格式&#10;• Gelbooru: Artist?/Tag?连续格式&#10;• Standard: 逗号分隔标准格式"
                aria-describedby="input-help"></textarea>
            <div id="format-status" class="status-indicator" style="display: none;"></div>
        </section>
        
        <!-- 操作按钮组 -->
        <section class="button-group">
            <button 
                onclick="pasteAndCopy(this)" 
                class="tooltip" 
                data-tooltip="从剪贴板粘贴内容，转换后自动复制结果"
                id="paste-copy-btn">
                🔄 粘贴并复制
            </button>
            <button 
                onclick="loadExample()" 
                class="secondary tooltip" 
                data-tooltip="循环加载不同格式的示例数据"
                id="load-example-btn">
                📝 加载示例
            </button>
            <button 
                onclick="clearAll()" 
                class="secondary tooltip" 
                data-tooltip="清空输入和输出内容">
                🗑️ 清空内容
            </button>
            <button 
                onclick="copyOutput(this)" 
                class="tooltip" 
                data-tooltip="复制转换结果到剪贴板">
                📋 复制结果
            </button>
        </section>
        
        <!-- 输出区域 -->
        <section class="output-section">
            <label for="output" class="output-label">转换结果</label>
            <div 
                id="output" 
                aria-live="polite" 
                aria-label="转换结果输出区域">等待输入内容进行转换...
            </div>
        </section>
        
        <!-- 自定义过滤器区域 -->
        <section class="filter-section" id="filter-section">
            <!-- 顶部工具区 -->
            <div class="filter-header">
                <div class="filter-title">🎯 自定义过滤器</div>
                <div class="filter-toolbar">
                    <button class="expand-button" id="filter-expand" onclick="toggleFilterSection()">
                        展开设置
                    </button>
                    <label class="filter-toggle" title="自定义过滤器总开关">
                        <input type="checkbox" id="filter-enabled" onchange="toggleFilter()">
                        <span class="toggle-slider"></span>
                    </label>
                    <button class="toolbar-btn" id="add-group-btn" onclick="addGroup()" title="新增组">
                        ➕
                    </button>
                    <button class="toolbar-btn" id="import-btn" onclick="importConfig()" title="导入配置">
                        📥
                    </button>
                    <button class="toolbar-btn" id="export-btn" onclick="exportConfig()" title="导出配置">
                        📤
                    </button>
                </div>
            </div>
            
            <!-- 统计条 -->
            <div class="filter-stats" id="filter-stats">
                <div class="filter-stat">
                    过滤规则: <span id="filter-count">0</span>
                </div>
                <div class="filter-stat">
                    上次过滤: <span id="filtered-count">0</span>（总命中）
                </div>
                <div class="filter-stat">
                    简化移除: <span id="simplified-count">0</span>
                </div>
            </div>
            
            <div class="filter-collapsed" id="filter-content">
                <!-- 分组容器 -->
                <div class="filter-groups" id="filter-groups">
                    <!-- 分组将在这里动态生成 -->
                </div>
                
                <!-- 空状态提示 -->
                <div class="empty-state" id="empty-state" style="display: none;">
                    <div class="empty-icon">📝</div>
                    <div class="empty-text">暂无过滤组</div>
                    <div class="empty-desc">点击上方"➕"按钮添加第一个过滤组</div>
                    <button class="empty-action" onclick="addGroup()">新增组</button>
                </div>
                
                <!-- 提示词简化功能 -->
                <div class="simplify-section">
                    <div class="simplify-header">
                        <label class="simplify-title">
                            🔄 提示词简化
                        </label>
                        <label class="filter-toggle" id="simplify-toggle">
                            <input type="checkbox" id="simplify-enabled" onchange="toggleSimplify()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="filter-help">
                        自动移除被其他提示词完全包含的冗余词汇 <br>
                        • 例如：移除"hat"当存在"red hat"时 <br>
                        • 确保词汇的完整性，避免误删 <br>
                        • 在分组过滤之后应用，优先级较低
                    </div>
                </div>
            </div>
        </section>
        
        <!-- 隐藏的文件输入 -->
        <input type="file" id="import-file" accept=".json" style="display: none;" onchange="handleImportFile(event)">
        
    </div>
    
    <!-- 组卡片模板 (隐藏) -->
    <template id="group-card-template">
        <div class="group-card" data-group-id="">
            <!-- 折叠态头部 -->
            <div class="group-header">
                <div class="drag-handle" aria-label="拖拽以改变组顺序" title="拖拽排序">
                    ☰
                </div>
                <label class="group-toggle">
                    <input type="checkbox" class="group-enabled" onchange="toggleGroup(this)">
                    <span class="toggle-slider"></span>
                </label>
                <input type="text" class="group-name" placeholder="组名" onchange="updateGroupName(this)" onblur="saveGroupName(this)">
                <div class="group-match-badge" title="上次命中数量">
                    •0
                </div>
                <button class="expand-group-btn" onclick="toggleGroupExpand(this)" aria-expanded="false" title="展开组设置">
                    ▼
                </button>
                <div class="group-menu">
                    <button class="menu-toggle" onclick="toggleGroupMenu(this)" title="更多操作">
                        ⋯
                    </button>
                    <div class="menu-dropdown" style="display: none;">
                        <button onclick="duplicateGroup(this)" class="menu-item">
                            📋 复制组
                        </button>
                        <button onclick="clearGroupMatchCount(this)" class="menu-item">
                            🔄 清零命中计数
                        </button>
                        <button onclick="deleteGroup(this)" class="menu-item delete-item">
                            🗑️ 删除组
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- 展开态内容 -->
            <div class="group-content" style="display: none;">
                <!-- 关键词编辑区 -->
                <div class="group-section">
                    <label class="section-label">过滤关键词</label>
                    <div class="keywords-editor">
                        <div class="keywords-tags" onclick="focusKeywordInput(this)"></div>
                        <input type="text" class="keyword-input" placeholder="输入关键词后按回车添加，支持正则表达式" onkeydown="handleKeywordInput(event)" onblur="addKeywordFromInput(this)">
                    </div>
                    <div class="keywords-help">
                        • 支持正则表达式和普通字符串匹配
                        • 可批量粘贴逗号分隔的关键词
                        • 点击标签可删除对应关键词
                    </div>
                </div>
                
                <!-- 替换短语区 -->
                <div class="group-section">
                    <label class="section-label">替换短语 <span class="optional">(可选)</span></label>
                    <input type="text" class="replacement-input" placeholder="用逗号分隔多个替换标签，留空仅删除" onchange="updateReplacement(this)" oninput="validateReplacement(this)">
                    <div class="replacement-error" role="alert" style="display: none;">
                        ⚠️ 替换短语格式错误：请使用"标签1, 标签2"格式（逗号后必须跟空格）
                    </div>
                    <div class="replacement-help">
                        • 留空表示仅删除匹配的标签
                        • 多个替换标签请用", "（逗号+空格）分隔
                        • 替换标签将插入到首次命中的原位置
                    </div>
                </div>
                
                <!-- 操作按钮 -->
                <div class="group-actions">
                    <button onclick="toggleGroupExpand(this)" class="collapse-btn">
                        收起 ▲
                    </button>
                </div>
            </div>
        </div>
    </template>
    
    <!-- 简化页脚 -->
    <footer class="footer">
        💡 <span class="footer-link" onclick="showAboutModal()">关于</span>
    </footer>
    
    <!-- 关于软件弹窗 -->
    <div id="aboutModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <button class="close-modal" onclick="hideAboutModal()">&times;</button>
                <h2>🏷️ Tag格式转换器</h2>
                <p>支持Danbooru、Gelbooru多格式智能转换</p>
            </div>
            <div class="modal-body">
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>📊 核心功能</h4>
                        <ul>
                            <li>四阶段智能处理流程</li>
                            <li>实时格式检测识别</li>
                            <li>自动清理去重处理</li>
                            <li>一键复制粘贴操作</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h4>🎯 支持格式</h4>
                        <ul>
                            <li>Danbooru 标准格式</li>
                            <li>Gelbooru 内容格式</li>
                            <li>通用逗号分隔格式</li>
                            <li>智能格式自动识别</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h4>🔍 高级特性</h4>
                        <ul>
                            <li>自定义过滤器系统</li>
                            <li>提示词智能简化</li>
                            <li>正则表达式支持</li>
                            <li>设置持久保存</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h4>🔧 技术特性</h4>
                        <ul>
                            <li>纯前端应用架构</li>
                            <li>无需服务器部署</li>
                            <li>数据本地安全处理</li>
                            <li>响应式界面设计</li>
                        </ul>
                    </div>
                </div>
                
                <div class="version-info">
                    <h4>💻 软件信息</h4>
                    <p><strong>版本：</strong>v4.4 增强版</p>
                    <p><strong>兼容性：</strong>现代浏览器 (ES6+)</p>
                    <p><strong>许可证：</strong>MIT</p>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>