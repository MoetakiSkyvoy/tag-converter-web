<!DOCTYPE html>
<html>
<head>
    <title>å‰ªè´´æ¿æƒé™ç®¡ç†æµ‹è¯•</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px;
            line-height: 1.6;
        }
        .test-section { 
            margin: 20px 0; 
            padding: 20px; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
        }
        .status { 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 5px; 
        }
        .success { background: #d4edda; color: #155724; }
        .warning { background: #fff3cd; color: #856404; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button {
            background: #007AFF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056CC; }
        button:disabled { 
            background: #ccc; 
            cursor: not-allowed; 
        }
        .code {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>å‰ªè´´æ¿æƒé™ç®¡ç†ç³»ç»Ÿæµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>ğŸ” å½“å‰çŠ¶æ€æ£€æŸ¥</h2>
        <div id="status-display">æ£€æŸ¥ä¸­...</div>
        <button onclick="checkCurrentStatus()">ğŸ”„ é‡æ–°æ£€æŸ¥çŠ¶æ€</button>
        <button onclick="resetPermissions()">ğŸ”„ é‡ç½®æƒé™çŠ¶æ€</button>
    </div>
    
    <div class="test-section">
        <h2>ğŸ§ª æƒé™æµ‹è¯•æµç¨‹</h2>
        <p>è¿™ä¸ªæµ‹è¯•å°†æ¨¡æ‹Ÿä¸»åº”ç”¨çš„æƒé™ç®¡ç†æµç¨‹ï¼š</p>
        <ol>
            <li>æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ</li>
            <li>æŸ¥è¯¢å½“å‰æƒé™çŠ¶æ€</li>
            <li>ç¼“å­˜æƒé™ç»“æœ</li>
            <li>å¤„ç†æƒé™è¯·æ±‚</li>
        </ol>
        <button onclick="runPermissionTest()">â–¶ï¸ è¿è¡Œå®Œæ•´æµ‹è¯•</button>
        <div id="test-results"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ“‹ å‰ªè´´æ¿æ“ä½œæµ‹è¯•</h2>
        <p>è¯·å…ˆå¤åˆ¶ä¸€äº›æ–‡æœ¬ï¼Œç„¶åæµ‹è¯•è¯»å–åŠŸèƒ½ï¼š</p>
        <textarea placeholder="å¤åˆ¶è¿™äº›æ–‡æœ¬è¿›è¡Œæµ‹è¯•ï¼šHello, World!" style="width: 100%; height: 60px;"></textarea>
        <br>
        <button onclick="testClipboardRead()">ğŸ“‹ æµ‹è¯•è¯»å–å‰ªè´´æ¿</button>
        <button onclick="testClipboardWrite()">ğŸ“¤ æµ‹è¯•å†™å…¥å‰ªè´´æ¿</button>
        <div id="clipboard-results"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ¯ æ”¹è¿›æ•ˆæœè¯´æ˜</h2>
        <div class="info">
            <h3>æƒé™ç®¡ç†ä¼˜åŒ–ï¼š</h3>
            <ul>
                <li><strong>æ™ºèƒ½ç¼“å­˜ï¼š</strong>é¦–æ¬¡æˆæƒåï¼Œç³»ç»Ÿä¼šè®°ä½æƒé™çŠ¶æ€</li>
                <li><strong>çŠ¶æ€æ£€æŸ¥ï¼š</strong>ä½¿ç”¨Permissions APIé¢„æ£€æŸ¥æƒé™</li>
                <li><strong>å‡å°‘æç¤ºï¼š</strong>å·²æˆæƒç”¨æˆ·ä¸å†çœ‹åˆ°é‡å¤çš„æƒé™æç¤º</li>
                <li><strong>è¯¦ç»†åé¦ˆï¼š</strong>æ˜¾ç¤ºå…·ä½“çš„æ“ä½œè¿›åº¦å’ŒçŠ¶æ€</li>
            </ul>
        </div>
        
        <div class="warning">
            <h3>âš ï¸ æµè§ˆå™¨é™åˆ¶è¯´æ˜ï¼š</h3>
            <p>ç”±äºå®‰å…¨è€ƒè™‘ï¼Œæµè§ˆå™¨çš„å‰ªè´´æ¿æƒé™æœ‰ä»¥ä¸‹é™åˆ¶ï¼š</p>
            <ul>
                <li>å¿…é¡»åœ¨ç”¨æˆ·äº¤äº’ï¼ˆç‚¹å‡»ï¼‰ä¸Šä¸‹æ–‡ä¸­è¯·æ±‚</li>
                <li>æƒé™çŠ¶æ€åœ¨é¡µé¢åˆ·æ–°åå¯èƒ½éœ€è¦é‡æ–°æ£€æŸ¥</li>
                <li>æŸäº›æµè§ˆå™¨å¯èƒ½ä»ä¼šæ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†</li>
                <li>éœ€è¦HTTPSç¯å¢ƒæ‰èƒ½å®Œå…¨å·¥ä½œ</li>
            </ul>
        </div>
    </div>
    
    <script>
        // æ¨¡æ‹Ÿä¸»åº”ç”¨çš„æƒé™ç®¡ç†å™¨
        const TestClipboardManager = {
            permissionGranted: false,
            permissionChecked: false,
            
            async checkPermission() {
                try {
                    if (this.permissionChecked && this.permissionGranted) {
                        return true;
                    }
                    
                    if ('permissions' in navigator) {
                        const permission = await navigator.permissions.query({ name: 'clipboard-read' });
                        
                        if (permission.state === 'granted') {
                            this.permissionGranted = true;
                            this.permissionChecked = true;
                            return true;
                        } else if (permission.state === 'denied') {
                            this.permissionGranted = false;
                            this.permissionChecked = true;
                            return false;
                        }
                    }
                    
                    return false;
                } catch (error) {
                    console.log('æƒé™æ£€æŸ¥å¤±è´¥:', error);
                    return false;
                }
            },
            
            async requestPermission() {
                try {
                    await navigator.clipboard.readText();
                    this.permissionGranted = true;
                    this.permissionChecked = true;
                    return true;
                } catch (error) {
                    if (error.name === 'NotAllowedError') {
                        this.permissionGranted = false;
                        this.permissionChecked = true;
                        return false;
                    }
                    this.permissionGranted = true;
                    this.permissionChecked = true;
                    return true;
                }
            },
            
            resetPermission() {
                this.permissionGranted = false;
                this.permissionChecked = false;
            }
        };
        
        async function checkCurrentStatus() {
            const statusDiv = document.getElementById('status-display');
            statusDiv.innerHTML = '<div class="info">æ£€æŸ¥ä¸­...</div>';
            
            let html = '';
            
            // æ£€æŸ¥APIæ”¯æŒ
            const clipboardSupported = !!(navigator.clipboard && navigator.clipboard.readText);
            const permissionsSupported = 'permissions' in navigator;
            
            html += `<div class="status ${clipboardSupported ? 'success' : 'error'}">
                ğŸ“± å‰ªè´´æ¿APIæ”¯æŒ: ${clipboardSupported ? 'âœ… æ”¯æŒ' : 'âŒ ä¸æ”¯æŒ'}
            </div>`;
            
            html += `<div class="status ${permissionsSupported ? 'success' : 'warning'}">
                ğŸ” æƒé™APIæ”¯æŒ: ${permissionsSupported ? 'âœ… æ”¯æŒ' : 'âš ï¸ ä¸æ”¯æŒï¼ˆå°†ä½¿ç”¨å›é€€æ–¹æ¡ˆï¼‰'}
            </div>`;
            
            if (clipboardSupported) {
                try {
                    const hasPermission = await TestClipboardManager.checkPermission();
                    html += `<div class="status ${hasPermission ? 'success' : 'warning'}">
                        ğŸ¯ æƒé™çŠ¶æ€: ${hasPermission ? 'âœ… å·²æˆæƒ' : 'âš ï¸ éœ€è¦æˆæƒ'}
                    </div>`;
                    
                    html += `<div class="status info">
                        ğŸ’¾ ç¼“å­˜çŠ¶æ€: å·²æ£€æŸ¥=${TestClipboardManager.permissionChecked}, å·²æˆæƒ=${TestClipboardManager.permissionGranted}
                    </div>`;
                } catch (error) {
                    html += `<div class="status error">
                        âŒ æƒé™æ£€æŸ¥å¤±è´¥: ${error.message}
                    </div>`;
                }
            }
            
            statusDiv.innerHTML = html;
        }
        
        function resetPermissions() {
            TestClipboardManager.resetPermission();
            checkCurrentStatus();
        }
        
        async function runPermissionTest() {
            const resultsDiv = document.getElementById('test-results');
            let html = '<h3>æµ‹è¯•ç»“æœï¼š</h3>';
            
            try {
                // æ­¥éª¤1ï¼šæ£€æŸ¥æƒé™
                html += '<div class="info">æ­¥éª¤1: æ£€æŸ¥æƒé™çŠ¶æ€...</div>';
                const hasPermission = await TestClipboardManager.checkPermission();
                html += `<div class="status ${hasPermission ? 'success' : 'warning'}">
                    æƒé™çŠ¶æ€: ${hasPermission ? 'å·²æœ‰æƒé™' : 'éœ€è¦è¯·æ±‚æƒé™'}
                </div>`;
                
                // æ­¥éª¤2ï¼šå¦‚æœæ²¡æœ‰æƒé™ï¼Œå°è¯•è¯·æ±‚
                if (!hasPermission) {
                    html += '<div class="info">æ­¥éª¤2: è¯·æ±‚æƒé™...</div>';
                    const granted = await TestClipboardManager.requestPermission();
                    html += `<div class="status ${granted ? 'success' : 'error'}">
                        æƒé™è¯·æ±‚ç»“æœ: ${granted ? 'âœ… å·²æˆæƒ' : 'âŒ è¢«æ‹’ç»'}
                    </div>`;
                } else {
                    html += '<div class="success">æ­¥éª¤2: è·³è¿‡æƒé™è¯·æ±‚ï¼ˆå·²æœ‰æƒé™ï¼‰</div>';
                }
                
                // æ­¥éª¤3ï¼šæµ‹è¯•è¯»å–
                html += '<div class="info">æ­¥éª¤3: æµ‹è¯•å‰ªè´´æ¿è¯»å–...</div>';
                try {
                    const text = await navigator.clipboard.readText();
                    html += `<div class="status success">
                        âœ… è¯»å–æˆåŠŸ: "${text.substring(0, 50)}${text.length > 50 ? '...' : ''}"
                    </div>`;
                } catch (error) {
                    html += `<div class="status error">
                        âŒ è¯»å–å¤±è´¥: ${error.message}
                    </div>`;
                }
                
            } catch (error) {
                html += `<div class="status error">
                    âŒ æµ‹è¯•è¿‡ç¨‹å‡ºé”™: ${error.message}
                </div>`;
            }
            
            resultsDiv.innerHTML = html;
        }
        
        async function testClipboardRead() {
            const resultsDiv = document.getElementById('clipboard-results');
            try {
                const text = await navigator.clipboard.readText();
                resultsDiv.innerHTML = `<div class="status success">
                    âœ… è¯»å–æˆåŠŸï¼å†…å®¹: "${text}"
                </div>`;
            } catch (error) {
                resultsDiv.innerHTML = `<div class="status error">
                    âŒ è¯»å–å¤±è´¥: ${error.message}
                </div>`;
            }
        }
        
        async function testClipboardWrite() {
            const resultsDiv = document.getElementById('clipboard-results');
            try {
                const testText = `æµ‹è¯•æ—¶é—´: ${new Date().toLocaleTimeString()}`;
                await navigator.clipboard.writeText(testText);
                resultsDiv.innerHTML = `<div class="status success">
                    âœ… å†™å…¥æˆåŠŸï¼å†…å®¹: "${testText}"
                </div>`;
            } catch (error) {
                resultsDiv.innerHTML = `<div class="status error">
                    âŒ å†™å…¥å¤±è´¥: ${error.message}
                </div>`;
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            checkCurrentStatus();
        });
    </script>
</body>
</html>